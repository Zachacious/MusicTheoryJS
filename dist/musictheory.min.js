!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).MusicTheory={})}(this,function(t){"use strict";var e;(o=e=e||{})[o.A=9]="A",o[o.As=10]="As",o[o.Bb=10]="Bb",o[o.B=11]="B",o[o.Bs=0]="Bs",o[o.Cb=11]="Cb",o[o.C=0]="C",o[o.Cs=1]="Cs",o[o.Db=1]="Db",o[o.D=2]="D",o[o.Ds=3]="Ds",o[o.Eb=3]="Eb",o[o.E=4]="E",o[o.Es=5]="Es",o[o.Fb=4]="Fb",o[o.F=5]="F",o[o.Fs=6]="Fs",o[o.Gb=6]="Gb",o[o.G=7]="G",o[o.Gs=8]="Gs",o[o.Ab=8]="Ab";const c=t=>{if(!t||0===t.length||1<t.length)throw new Error("Invalid name");t=t[0].toUpperCase();return e[t]};var n,i=e;const l=(t,e,n)=>{let i=t,s=e,o=n;n<e&&(s=n,o=e);e=0-s;s+=e,o+=e,i+=e;let r=Math.trunc(i/o);0===r&&i<s&&(r=-1),1===r&&i===o&&(r=0);let a=0,h=0;return-1<=r&&r<=1&&(h=1),i<s?(a=i%o+h,i=o+a):i>o&&(a=i%o-h,i=s+a),i-=e,{value:i,numWraps:r}},u=(t,e,n)=>Math.max(Math.min(t,Math.max(e,n)),Math.min(e,n)),s=[1,3,4,6,8,10],m=11,p=0,v=9,f=0;(o=n=n||{})[o.FLAT=-1]="FLAT",o[o.NATURAL=0]="NATURAL",o[o.SHARP=1]="SHARP";const d=t=>{switch(t){case"b":case"flat":return n.FLAT;case"#":case"s":case"sharp":return n.SHARP;default:return n.NATURAL}};var o=n;const a=/([A-G])/g,h=/(#|s|b)/g,g=/([0-9]*)/g,r=(e,n=!1)=>{try{var i=b[e];if(i)return i;n||console.warn(`Ineffecient note string formatting - ${e}. Get a performanc increase by using the format [A-G][#|s|b][0-9]`)}catch(t){n||console.warn(`Ineffecient note string formatting - ${e}. Get a performanc increase by using the format [A-G][#|s|b][0-9]`)}let s=0,o="";i=e.match(a)?.join("").split("");const t=e.match(h)?.join("").split("");n=e.match(g)?.join("").split("");if(t&&(s=1<t.length?t.reduce((t,e)=>{return(t="string"==typeof t?d(t):t)+d(e)}):d(t[0])),n&&([n]=n,o=n),i){var[i]=i,r=i;let t=0;s&&(t=s);r=l(c(r)+t,p,m).value;let e=4;return o&&(e=u(parseInt(o),f,v)),{semitone:r,octave:e}}throw new Error("Invalid note: "+e)};const b=(()=>{const n={};var i=["b","#","s"];for(const o of["A","B","C","D","E","F","G"]){n[o]=r(o,!0);for(let t=0;t<i.length;++t){var e=""+o+i[t];n[e]=r(e,!0)}for(let e=f;e<v;++e){var t=""+o+e;n[t]=r(t,!0);for(let t=0;t<i.length;++t){var s=""+o+i[t]+e;n[s]=r(s,!0)}}}return n})(),y=["C","C#/Db","D","D#/Eb","E","F","F#/Gb","G","G#/Ab","A","A#/Bb","B"],_=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],A=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"];const w=(()=>{const i={};for(let n=p;n<=m;++n)for(let e=p;e<=m;++e){let t="";s.includes(n)&&(t="-",l(n+1,p,m).value===e&&(t="b"),l(n-1,p,m).value===e&&(t="#")),i[n+"-"+e]=((t,e)=>{switch(e){case"#":return _[t];case"b":return A[t];case"-":default:return y[t]}})(n,t)}return i})();for(var k,j=256,G=[];j--;)G[j]=(j+256).toString(16).substring(1);function T(t){var e=0,t=t||11;if(!k||512<j+t)for(k="",j=0;e<256;e++)k+=G[256*Math.random()|0];return k.substring(j,j+++t)}class I{constructor(t){t?("string"==typeof t&&(t=r(t)),this.octave=t?.octave??4,this.semitone=t?.semitone??0,this._prevSemitone=this._tone):(this.octave=4,this.semitone=0)}id=T();_tone=0;_prevSemitone=0;get semitone(){return this._tone}set semitone(t){t=l(t,p,m);this._prevSemitone=this._tone,this._tone=t.value,this._octave=this._octave+t.numWraps}_octave=4;get octave(){return this._octave}set octave(t){this._octave=u(t,f,v)}sharp(){return new I({semitone:this.semitone,octave:this.octave}).sharpen()}sharpen(){return this.semitone=this.semitone+1,this}isSharp(){return!!s.includes(this.semitone)&&l(this.semitone+1,p,m).value!==this._prevSemitone}flat(){return new I({semitone:this.semitone,octave:this.octave}).flatten()}flatten(){return this.semitone=this.semitone-1,this}isFlat(){return!!s.includes(this.semitone)&&l(this.semitone-1,p,m).value!==this._prevSemitone}equals(t){return this.semitone===t.semitone&&this.octave===t.octave}copy(){return new I({semitone:this.semitone,octave:this.octave})}toString(){return w[this._tone+"-"+this._prevSemitone]+(""+this._octave)}static A(t=4){return new I({semitone:i.A,octave:t})}static B(t=4){return new I({semitone:i.B,octave:t})}static C(t=4){return new I({semitone:i.C,octave:t})}static D(t=4){return new I({semitone:i.D,octave:t})}static E(t=4){return new I({semitone:i.E,octave:t})}static F(t=4){return new I({semitone:i.F,octave:t})}static G(t=4){return new I({semitone:i.G,octave:t})}}const D=12,M=12,F=(t=440)=>{const e={},n={};let i=0,s=0;for(i=0;i<10;++i)for(s=0;s<M;++s){var o=i+"-"+s,r=(r=i,a=s,D+r*M+a),a=2**((r-69)/12)*t;n[o]=r,e[o]=a}var r,a;return{freqLookup:e,midiLookup:n}};class S{constructor(t=440){this._a4=t,this.buildTables()}id=T();_a4=440;get a4(){return this._a4}set a4(t){this._a4=t,this.buildTables()}_midiKeyTable={};midiKeyLookup(t,e){return this._midiKeyTable[t+"-"+e]}_freqTable={};freqLookup(t,e){return this._freqTable[t+"-"+e]}buildTables(){var t=F(this._a4);this._midiKeyTable=t.midiLookup,this._freqTable=t.freqLookup}toString(){return`Tuning(${this._a4})`}}const E=[0,2,2,1,2,2,2],B={wholeTone:[0,2,2,2,2,2,2],major:[0,2,2,1,2,2,2],major7s4s5:[0,2,2,2,2,1,2],dorian:[0,2,1,2,2,2,1],phrygian:[0,1,2,2,2,1,2],lydian:[0,2,2,2,1,2,2],lydianDominant:[0,2,2,2,1,2,1],mixolydian:[0,2,2,1,2,2,1],mixolydianFlat6:[0,2,2,1,2,1,2],locrian:[0,1,2,2,1,2,2],superLocrian:[0,1,2,1,2,2,2],minor:[0,2,1,2,2,1,2],minor7b9:[0,1,2,2,2,2,1],minor7b5:[0,2,1,2,1,2,2],harmonicMajor:[0,2,2,1,2,1,3],harmonicMinor:[0,2,1,2,2,1,3],doubleHarmonic:[0,1,3,1,2,1,3],melodicMinorAscending:[0,2,1,2,2,2,2],melodicMinorDescending:[0,2,2,1,2,2,1],majorPentatonic:[0,2,2,3,2],majorPentatonicBlues:[0,2,1,1,3,2],minorPentatonic:[0,3,2,2,3],minorPentatonicBlues:[0,3,2,1,1,3],b5Pentatonic:[0,3,2,1,4,2],minor6Pentatonic:[0,3,2,2,2,3],enigmaticMajor:[0,1,3,2,2,2,1],enigmaticMinor:[0,1,2,3,1,3,1],dim8Tone:[0,2,1,2,1,2,1,2],dom8Tone:[0,1,2,1,2,1,2,1],neapolitanMajor:[0,1,2,2,2,2,2],neapolitanMinor:[0,1,2,2,2,1,3],hungarianMajor:[0,3,1,2,1,2,1],hungarianMinor:[0,2,1,3,1,1,3],hungarianGypsy:[0,1,3,1,2,1,3],spanish:[0,1,2,1,2,2,2],spanish8Tone:[0,1,2,1,1,1,2,2],spanishGypsy:[0,1,3,1,2,1,2],augmented:[0,3,1,3,1,3,1],dominantSuspended:[0,2,3,2,2,1,2],bebopMajor:[0,2,2,1,2,1,1,2],bebopDominant:[0,2,2,1,2,2,1,1],mystic:[0,2,2,2,3,2],overtone:[0,2,2,2,1,1,2],leadingTone:[0,2,2,2,2,2,1],hirojoshi:[0,2,1,4,1],japaneseA:[0,1,4,1,3],japaneseB:[0,2,3,1,3],oriental:[0,1,3,1,1,3,1],persian:[0,1,4,1,2,3],arabian:[0,2,2,1,1,2,2],balinese:[0,1,2,4,1],kumoi:[0,2,1,4,2,2],pelog:[0,1,2,3,1,1],algerian:[0,2,1,2,1,1,1,3],chinese:[0,4,2,1,4],mongolian:[0,2,2,3,2],egyptian:[0,2,3,2,3],romainian:[0,2,1,3,1,2,1],hindu:[0,2,2,1,2,1,2],insen:[0,1,4,2,3],iwato:[0,1,4,1,4],scottish:[0,2,3,2,2],yo:[0,3,2,2,3],istrian:[0,1,2,2,2,1,2],ukranianDorian:[0,2,1,3,1,2,1],petrushka:[0,1,3,2,1,3],ahavaraba:[0,1,3,1,2,1,2]};B.halfDiminished=B.minor7b5,B.jewish=B.spanish8Tone,B.byzantine=B.doubleHarmonic,B.acoustic=B.lydianDominant,B.aeolian=B.minor,B.ionian=B.major;const C=/([A-G])/g,L=/(#|s|b)/g,x=/([0-9]*)/g,N=/([A-Z|a-z]*)/g,q=(e,n=!1)=>{try{var t=P[e];if(t)return t;n||console.warn(`Ineffecient note string formatting - ${e}. Get a performanc increase by using the format [A-G][#|s|b][0-9]`)}catch(t){n||console.warn(`Ineffecient note string formatting - ${e}. Get a performanc increase by using the format [A-G][#|s|b][0-9]`)}let i=0,s="",o="";var r=e.match(C)?.join("").split("");const a=e.match(L)?.join("").split("");t=e.match(x)?.join("").split(""),n=e.match(N)?.join("").split("");if(a&&(i=1<a.length?a.reduce((t,e)=>{return(t="string"==typeof t?d(t):t)+d(e)}):d(a[0])),t&&([t]=t,s=t),n&&([n]=n,o=n),r){var[r]=r,h=r;let t=0;i&&(t=i);r=l(c(h)+t,p,m).value;let e=4;s&&(e=u(parseInt(s),f,v));h=Object.keys(B).findIndex(t=>t.toLowerCase().includes(o.toLowerCase()));if(-1===h)throw new Error("Unable to find template for scale "+o);h=B[h];return{key:r,octave:e,template:h}}throw new Error("Invalid Scale: "+e)};const P=(()=>{const n={};var t=["A","B","C","D","E","F","G"],i=["b","#","s"];for(const r of Object.keys(B))for(const a of t){n[a+r]=q(a,!0);for(let t=0;t<i.length;++t){var e=""+a+i[t]+r;n[e]=q(e,!0)}for(let e=f;e<v;++e){var s=""+a+e+r;n[s]=q(s,!0);for(let t=0;t<i.length;++t){var o=""+a+i[t]+e+r;n[o]=q(o,!0)}}}return n})(),$=(t,e)=>{var n;return 0<e&&(n=t.splice(t.length-(e+1),1/0),t.unshift(...n)),e<0&&(e=t.splice(0,e),t.push(...e)),t};t.Instrument=class{tuning;constructor(t=440){this.tuning=new S(t)}id=T();getFrequency(t){return this.tuning.freqLookup(t.octave,t.semitone)}getMidiKey(t){return this.tuning.midiKeyLookup(t.octave,t.semitone)}toString(){return`Instrument Tuning(${this.tuning.a4})`}},t.Modifier=o,t.Note=I,t.Scale=class K{constructor(t){t?("string"==typeof t&&(t=q(t)),this.template=t.template||E,this.key=t.key||0,this.octave=t.octave||4):(this.template=E,this.key=0,this.octave=4),this.generateNotes()}id=T();equals(t){return this._key===t._key&&this._octave===t._octave&&this._template===t._template}copy(){const t=new K({key:this.key,octave:this.octave,template:this.template});return 0!==this._shiftedInterval&&t.shift(this._shiftedInterval),t}_key=0;get key(){return this._key}set key(t){t=l(t,p,m),this.octave=this.octave+t.numWraps,this._key=t.value,this.generateNotes()}_octave=4;get octave(){return this._octave}set octave(t){this._octave=u(t,f,v),this.generateNotes()}_template=[];get template(){return this._template}set template(t){this._template=t,this._shiftedInterval=0,this.generateNotes()}_notes=[];get notes(){return this._notes}generateNotes(){var t,e=$(this._template,-this._shiftedInterval);const n=[];let i=this.key;for(const o of e){var s=new I({semitone:i+=o,octave:this.octave});n.push(s)}0<this._shiftedInterval&&(t=n.splice(n.length-(this._shiftedInterval+1),1/0),n.unshift(...t)),this._shiftedInterval<0&&(t=n.splice(0,this._shiftedInterval),n.push(...t)),this._notes=n}degree(t){t=l(t+1,0,this.notes.length-1);const e=this.notes[t.value];return e.octave=this.octave+t.numWraps,e}relativeMajor(){return new K({template:B.major,key:this.degree(3).semitone,octave:this.octave})}relativeMinor(){return new K({template:B.minor,key:this.degree(6).semitone,octave:this.octave})}_shiftedInterval=0;shift(t=1){return this._template=$(this._template,t),this._shiftedInterval+=t,this.generateNotes(),this}shifted(t=1){const e=this.copy();return e.shift(t),e}unshift(){return 0!==this._shiftedInterval&&(this.shift(-1*this._shiftedInterval),this._shiftedInterval=0,this.generateNotes()),this}unshifted(){const t=this.copy();return t.unshift(),t}ionian(){const t=this.copy();return t.template=B.ionian,t}dorian(){const t=this.copy();return t.template=B.dorian,t}phrygian(){const t=this.copy();return t.template=B.phrygian,t}lydian(){const t=this.copy();return t.template=B.lydian,t}mixolydian(){const t=this.copy();return t.template=B.mixolydian,t}aeolian(){const t=this.copy();return t.template=B.aeolian,t}locrian(){const t=this.copy();return t.template=B.locrian,t}toString(){let t="Unknown Scale";var e=Object.values(B).findIndex(t=>t===this.template);return-1!==e&&(t=Object.keys(B)[e]),`${i[this._key]} ${t} `+this.octave}},t.ScaleTemplates=B,t.Semitone=i,Object.defineProperty(t,"__esModule",{value:!0})});
