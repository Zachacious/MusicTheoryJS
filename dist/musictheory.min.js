!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).MusicTheory={})}(this,function(t){"use strict";var e;(r=e=e||{})[r.A=9]="A",r[r.As=10]="As",r[r.Bb=10]="Bb",r[r.B=11]="B",r[r.Bs=0]="Bs",r[r.Cb=11]="Cb",r[r.C=0]="C",r[r.Cs=1]="Cs",r[r.Db=1]="Db",r[r.D=2]="D",r[r.Ds=3]="Ds",r[r.Eb=3]="Eb",r[r.E=4]="E",r[r.Es=5]="Es",r[r.Fb=4]="Fb",r[r.F=5]="F",r[r.Fs=6]="Fs",r[r.Gb=6]="Gb",r[r.G=7]="G",r[r.Gs=8]="Gs",r[r.Ab=8]="Ab";const f=t=>{if(!t||0===t.length||1<t.length)throw new Error("Invalid name");t=t[0].toUpperCase();return e[t]};var n,i=e;const v=(t,e,n)=>{let i=t,s=e,o=n;n<e&&(s=n,o=e);e=0-s;s+=e,o+=e,i+=e;let a=Math.trunc(i/o);0===a&&i<s&&(a=-1),1===a&&i===o&&(a=0);let r=0,c=0;return-1<=a&&a<=1&&(c=1),i<s?(r=i%o+c,i=o+r):i>o&&(r=i%o-c,i=s+r),i-=e,{value:i,numWraps:a}},g=(t,e,n)=>Math.max(Math.min(t,Math.max(e,n)),Math.min(e,n)),s=[1,3,4,6,8,10],d=11,y=0,_=9,b=0;(bt=n=n||{})[bt.FLAT=-1]="FLAT",bt[bt.NATURAL=0]="NATURAL",bt[bt.SHARP=1]="SHARP";const j=t=>{switch(t){case"b":case"flat":return n.FLAT;case"#":case"s":case"sharp":return n.SHARP;default:return n.NATURAL}};var o=n;const a=[];var r=t=>{if(!t)throw new Error("Initializer must be a function");a.push(t)};const c=/([A-G])/g,h=/(#|s|b)/g,l=/([0-9]+)/g,m=(e,n=!1)=>{try{var i=k(e);if(i)return i;n||console.warn(`Ineffecient note string formatting - ${e}. Get a performanc increase by using the format [A-G][#|s|b][0-9]`)}catch(t){n||console.warn(`Ineffecient note string formatting - ${e}. Get a performanc increase by using the format [A-G][#|s|b][0-9]`)}let s=0,o="";i=e.match(c)?.join("").split("");const t=e.match(h)?.join("").split("");n=e.match(l)?.join("").split("");if(t&&(s=1<t.length?t.map(t=>j(t)).reduce((t,e)=>t+e):j(t[0])),n&&([n]=n,o=n),i){var[i]=i,a=i;let t=0;s&&(t=s);a=v(f(a)+t,y,d).value;let e=4;return o&&(e=g(parseInt(o,10),b,_)),{semitone:a,octave:e}}throw new Error("Invalid note: "+e)},u=()=>{const n={};var i=["b","#","s"];for(const o of["A","B","C","D","E","F","G"]){n[o]=m(o,!0);for(let t=0;t<i.length;++t){var e=""+o+i[t];n[e]=m(e,!0)}for(let e=b;e<_;++e){var t=""+o+e;n[t]=m(t,!0);for(let t=0;t<i.length;++t){var s=""+o+i[t]+e;n[s]=m(s,!0)}}}return n};let p={};const k=t=>(p=p||u(),p[t]);r(()=>{p=u()});const N=["C","C#/Db","D","D#/Eb","E","F","F#/Gb","G","G#/Ab","A","A#/Bb","B"],w=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],A=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],T=()=>{const i={};for(let n=y;n<=d;++n)for(let e=y;e<=d;++e){let t="";s.includes(n)&&(t="-",v(n+1,y,d).value===e&&(t="b"),v(n-1,y,d).value===e&&(t="#")),i[n+"-"+e]=((t,e)=>{switch(e){case"#":return w[t];case"b":return A[t];case"-":default:return N[t]}})(n,t)}return i};let I={};r(()=>{I=T()});for(var S,E=256,O=[],G=256;E--;)O[E]=(E+256).toString(16).substring(1);function D(t){var e=0,t=t||11;if(!S||2*G<E+t)for(S="",E=0;e<G;e++)S+=O[256*Math.random()|0];return S.substring(E,E+++t)}class L{constructor(t){t?("string"==typeof t&&(t=m(t)),this.octave=t?.octave??4,this.semitone=t?.semitone??0,this._prevSemitone=this._tone):(this.octave=4,this.semitone=0)}id=D();_tone=0;_prevSemitone=0;get semitone(){return this._tone}set semitone(t){t=v(t,y,d);this._prevSemitone=this._tone,this._tone=t.value,this._octave=this._octave+t.numWraps}_octave=4;get octave(){return this._octave}set octave(t){this._octave=g(t,b,_)}sharp(){return new L({semitone:this.semitone,octave:this.octave}).sharpen()}sharpen(){return this.semitone=this.semitone+1,this}isSharp(){return!!s.includes(this.semitone)&&v(this.semitone+1,y,d).value!==this._prevSemitone}flat(){return new L({semitone:this.semitone,octave:this.octave}).flatten()}flatten(){return this.semitone=this.semitone-1,this}isFlat(){return!!s.includes(this.semitone)&&v(this.semitone-1,y,d).value!==this._prevSemitone}equals(t){return this.semitone===t.semitone&&this.octave===t.octave}copy(){return new L({semitone:this.semitone,octave:this.octave})}toString(){return t=this._tone+"-"+this._prevSemitone,I=I||T(),I[t]+(""+this._octave);var t}static A(t=4){return new L({semitone:i.A,octave:t})}static B(t=4){return new L({semitone:i.B,octave:t})}static C(t=4){return new L({semitone:i.C,octave:t})}static D(t=4){return new L({semitone:i.D,octave:t})}static E(t=4){return new L({semitone:i.E,octave:t})}static F(t=4){return new L({semitone:i.F,octave:t})}static G(t=4){return new L({semitone:i.G,octave:t})}}const M=12,$=10,C=12,B=(t,e)=>M+t*C+e,F=(t,e)=>2**((t-69)/12)*e;class x{constructor(t=440){this._a4=t,this.buildTables()}id=D();copy(){return new x(this._a4)}equals(t){return this._a4===t._a4}_a4=440;get a4(){return this._a4}set a4(t){this._a4=t,this.buildTables()}_midiKeyTable={};midiKeyLookup(t,e){return this._midiKeyTable[t+"-"+e]}_freqTable={};freqLookup(t,e){return this._freqTable[t+"-"+e]}buildTables(){var t=((t=440)=>{const e={},n={};let i=0,s=0;for(i=0;i<$;++i)for(s=0;s<C;++s){var o=i+"-"+s,a=B(i,s),r=F(a,t);n[o]=a,e[o]=r}return{freqLookup:e,midiLookup:n}})(this._a4);this._midiKeyTable=t.midiLookup,this._freqTable=t.freqLookup}toString(){return`Tuning(${this._a4})`}}const P=[0,2,2,1,2,2,2];Object.freeze(P);const q={wholeTone:[0,2,2,2,2,2,2],major:[0,2,2,1,2,2,2],major7s4s5:[0,2,2,2,2,1,2],dorian:[0,2,1,2,2,2,1],phrygian:[0,1,2,2,2,1,2],lydian:[0,2,2,2,1,2,2],lydianDominant:[0,2,2,2,1,2,1],mixolydian:[0,2,2,1,2,2,1],mixolydianFlat6:[0,2,2,1,2,1,2],locrian:[0,1,2,2,1,2,2],superLocrian:[0,1,2,1,2,2,2],minor:[0,2,1,2,2,1,2],minor7b9:[0,1,2,2,2,2,1],minor7b5:[0,2,1,2,1,2,2],harmonicMajor:[0,2,2,1,2,1,3],harmonicMinor:[0,2,1,2,2,1,3],doubleHarmonic:[0,1,3,1,2,1,3],melodicMinorAscending:[0,2,1,2,2,2,2],melodicMinorDescending:[0,2,2,1,2,2,1],majorPentatonic:[0,2,2,3,2],majorPentatonicBlues:[0,2,1,1,3,2],minorPentatonic:[0,3,2,2,3],minorPentatonicBlues:[0,3,2,1,1,3],b5Pentatonic:[0,3,2,1,4,2],minor6Pentatonic:[0,3,2,2,2,3],enigmaticMajor:[0,1,3,2,2,2,1],enigmaticMinor:[0,1,2,3,1,3,1],dim8Tone:[0,2,1,2,1,2,1,2],dom8Tone:[0,1,2,1,2,1,2,1],neapolitanMajor:[0,1,2,2,2,2,2],neapolitanMinor:[0,1,2,2,2,1,3],hungarianMajor:[0,3,1,2,1,2,1],hungarianMinor:[0,2,1,3,1,1,3],hungarianGypsy:[0,1,3,1,2,1,3],spanish:[0,1,2,1,2,2,2],spanish8Tone:[0,1,2,1,1,1,2,2],spanishGypsy:[0,1,3,1,2,1,2],augmented:[0,3,1,3,1,3,1],dominantSuspended:[0,2,3,2,2,1,2],bebopMajor:[0,2,2,1,2,1,1,2],bebopDominant:[0,2,2,1,2,2,1,1],mystic:[0,2,2,2,3,2],overtone:[0,2,2,2,1,1,2],leadingTone:[0,2,2,2,2,2,1],hirojoshi:[0,2,1,4,1],japaneseA:[0,1,4,1,3],japaneseB:[0,2,3,1,3],oriental:[0,1,3,1,1,3,1],persian:[0,1,4,1,2,3],arabian:[0,2,2,1,1,2,2],balinese:[0,1,2,4,1],kumoi:[0,2,1,4,2,2],pelog:[0,1,2,3,1,1],algerian:[0,2,1,2,1,1,1,3],chinese:[0,4,2,1,4],mongolian:[0,2,2,3,2],egyptian:[0,2,3,2,3],romainian:[0,2,1,3,1,2,1],hindu:[0,2,2,1,2,1,2],insen:[0,1,4,2,3],iwato:[0,1,4,1,4],scottish:[0,2,3,2,2],yo:[0,3,2,2,3],istrian:[0,1,2,2,2,1,2],ukranianDorian:[0,2,1,3,1,2,1],petrushka:[0,1,3,2,1,3],ahavaraba:[0,1,3,1,2,1,2]};q.halfDiminished=q.minor7b5,q.jewish=q.spanish8Tone,q.byzantine=q.doubleHarmonic,q.acoustic=q.lydianDominant,q.aeolian=q.minor,q.ionian=q.major,Object.keys(q).forEach(t=>Object.freeze(q[t]));const J=/([A-G])(?![^(]*\))/g,z=/(#|s|b)(?![^(]*\))/g,K=/([0-9]+)(?![^(]*\))/g,U=/(\([a-zA-Z]{2,}\))/g,W=(e,n=!1)=>{try{var i=Z(e);if(i)return i;n||console.warn(`Ineffecient scale string formatting - ${e}. Get a performanc increase by using a valid format`)}catch(t){n||console.warn(`Ineffecient scale string formatting - ${e}. Get a performanc increase by using a valid format`)}let s=0,o="",a="";i=e.match(J)?.join("").split("");const t=e.match(z)?.join("").split("");var r,n=e.match(K)?.join("").split("");const c=e.match(U)?.join("").split("");if(t&&(s=1<t.length?t.map(t=>j(t)).reduce((t,e)=>t+e):j(t[0])),n&&([r]=n,o=r),c&&(r=c.join(""),a=r),i){var[i]=i,h=i;let t=0;s&&(t=s);i=v(f(h)+t,y,d).value;let e=4;o&&(e=g(parseInt(o,10),b,_));let n=1;if(a&&(n=Object.keys(q).findIndex(t=>t.toLowerCase().includes(a.toLowerCase().replace(/\(|\)/g,"")))),-1===n)throw console.log("UNKNOWN TEMPLATE",a),new Error("Unable to find template for scale "+a);h=q[Object.keys(q)[n]];return{key:i,octave:e,template:h}}throw new Error("Invalid Scale: "+e)},H=()=>{const e={};var t=["A","B","C","D","E","F","G"],n=["b","#","s"];for(const a of Object.keys(q))for(const r of t){e[`${r}(${a})`]=W(r,!0);for(const c of n){var i=""+r+c+`(${a})`;e[i]=W(i,!0)}for(let t=b;t<_;++t){var s=""+r+t+`(${a})`;e[s]=W(s,!0);for(const h of n){var o=""+r+h+t+`(${a})`;e[o]=W(o,!0)}}}return e};let R={};const Z=t=>(R=R||H(),R[t]);r(()=>{R=H()});const Q=(t,e=1)=>{if(e>(t=[...t]).length||e<0-t.length)throw new Error("shift: distance is greater than array length");var n;return 0<e&&(n=t.splice(t.length-e,1/0),t.unshift(...n)),e<0&&(e=t.splice(0,e),t.push(...e)),t},V=t=>JSON.parse(JSON.stringify(t)),X=(t,e)=>{return JSON.stringify(t)===JSON.stringify(e)},Y=(e,n=!1)=>{try{var t=nt(JSON.stringify(e));if(t)return t}catch(t){n||console.warn(t)}const i=Object.keys(q);var s=Object.values(q);const o=[];for(let t=0;t<i.length;++t)X(s[t],e)&&o.push(i[t].charAt(0).toUpperCase()+i[t].slice(1));return o.join(" AKA ")},tt=()=>{const t={};for(const e of Object.values(q))t[JSON.stringify(e)]=Y(e,!0);return t};let et={};const nt=t=>(et[t]||(et=tt()),et[t]);r(()=>{et=tt()});class it{constructor(t){t?("string"==typeof t&&(t=W(t)),this.template=[...t?.template??P],this.key=t.key||0,this.octave=t.octave||4):(this.template=P,this.key=0,this.octave=4),this.generateNotes()}id=D();equals(t){return this._key===t._key&&this._octave===t._octave&&X(this._template,t._template)}copy(){const t=new it({key:this.key,octave:this.octave,template:V(this.template)});return 0!==this._shiftedInterval&&t.shift(this._shiftedInterval),t}_key=0;get key(){return this._key}set key(t){t=v(t,y,d);this.octave=this.octave+t.numWraps,this._key=t.value,this.generateNotes()}_octave=4;get octave(){return this._octave}set octave(t){this._octave=g(t,b,_),this.generateNotes()}_template=[];get template(){return V(this._template)}set template(t){this._template=V(t),this._shiftedInterval=0,this.generateNotes()}_notes=[];get notes(){return this._notes}generateNotes(){var t,e=Q(this._template,-this._shiftedInterval);const n=[];let i=this.key;for(const o of e){var s=0===o?i=this.key:i+=o,s=new L({semitone:s,octave:this.octave});n.push(s)}0<this._shiftedInterval&&(t=n.splice(n.length-(this._shiftedInterval+1),1/0),n.unshift(...t)),this._shiftedInterval<0&&(t=n.splice(0,this._shiftedInterval),n.push(...t)),this._notes=n}getNoteNames(t=!0){return it.scaleNoteNameLookup(this,t)}degree(t){t=v(t-1,0,this.notes.length-1);const e=this.notes[t.value].copy();return e.octave=this.octave+t.numWraps,e}relativeMajor(){return new it({template:q.major,key:this.degree(3).semitone,octave:this.octave})}relativeMinor(){return new it({template:q.minor,key:this.degree(6).semitone,octave:this.octave})}_shiftedInterval=0;_originalTemplate=[];shift(t=1){return 0===this._shiftedInterval&&(this._originalTemplate=V(this._template)),this._template=Q(this._template,t),this._shiftedInterval+=t,this.generateNotes(),this}shifted(t=1){const e=this.copy();return e.shift(t),e}unshift(){return 0!==this._shiftedInterval&&(0<this._originalTemplate.length&&(this._template=this._originalTemplate),this._shiftedInterval=0,this._originalTemplate=[],this.generateNotes()),this}unshifted(){const t=this.copy();return this._originalTemplate.length&&(t.template=this._originalTemplate),t.unshift(),t}shiftedInterval(){return this._shiftedInterval}ionian(){const t=this.copy();return t.template=q.ionian,t}dorian(){const t=this.copy();return t.template=q.dorian,t}phrygian(){const t=this.copy();return t.template=q.phrygian,t}lydian(){const t=this.copy();return t.template=q.lydian,t}mixolydian(){const t=this.copy();return t.template=q.mixolydian,t}aeolian(){const t=this.copy();return t.template=q.aeolian,t}locrian(){const t=this.copy();return t.template=q.locrian,t}toString(){let t=Y(this._template);return t=t||this.getNoteNames().join(", "),""+i[this._key]+this._octave+`(${t})`}static scaleNoteNameLookup(t,e=!0){try{var n=`${t.key}-${t.octave}-`+JSON.stringify(t.template);const i=this._notesLookup[n];if(i)return i}catch(t){}let i=[...t.notes];var s;i=Q(i,-t.shiftedInterval());const o=["B#","Bs","Cb","E#","Es","Fb"],a=[];for(const c of i.map(t=>t.toString().split("/"))){for(const h of c)o.includes(h)&&(s=a.indexOf(h),a.splice(s,1));if(0!==a.length)if(1!==c.length){const l=["A","B","C","D","E","F","G","A","B","C","D","E","F","G"];var r=a[a.length-1][0],r=l.indexOf(r),r=l[r+1];c[0].includes(r)?a.push(c[0]):a.push(c[c.length-1])}else a.push(c[0]);else a.push(e?c[0]:c[c.length-1])}return Q(a,t.shiftedInterval())}static createNotesLookupTable(){const n={};for(let e=y;e<y+_;e++)for(let t=b;t<=_;t++)for(const s of Object.values(q)){var i=new it({key:e,template:s,octave:t});n[`${e}-${t}-`+JSON.stringify(s)]=it.scaleNoteNameLookup(i)}return n}static _notesLookup={};static async init(){it._notesLookup=it.createNotesLookupTable()}}r(it.init);const st=[0,2,2,1,2,2,2];Object.freeze(st);const ot={wholeTone:[0,2,2,2,2,2,2],major:[0,2,2,1,2,2,2],major7s4s5:[0,2,2,2,2,1,2],dorian:[0,2,1,2,2,2,1],phrygian:[0,1,2,2,2,1,2],lydian:[0,2,2,2,1,2,2],lydianDominant:[0,2,2,2,1,2,1],mixolydian:[0,2,2,1,2,2,1],mixolydianFlat6:[0,2,2,1,2,1,2],locrian:[0,1,2,2,1,2,2],superLocrian:[0,1,2,1,2,2,2],minor:[0,2,1,2,2,1,2],minor7b9:[0,1,2,2,2,2,1],minor7b5:[0,2,1,2,1,2,2],harmonicMajor:[0,2,2,1,2,1,3],harmonicMinor:[0,2,1,2,2,1,3],doubleHarmonic:[0,1,3,1,2,1,3],melodicMinorAscending:[0,2,1,2,2,2,2],melodicMinorDescending:[0,2,2,1,2,2,1],majorPentatonic:[0,2,2,3,2],majorPentatonicBlues:[0,2,1,1,3,2],minorPentatonic:[0,3,2,2,3],minorPentatonicBlues:[0,3,2,1,1,3],b5Pentatonic:[0,3,2,1,4,2],minor6Pentatonic:[0,3,2,2,2,3],enigmaticMajor:[0,1,3,2,2,2,1],enigmaticMinor:[0,1,2,3,1,3,1],dim8Tone:[0,2,1,2,1,2,1,2],dom8Tone:[0,1,2,1,2,1,2,1],neapolitanMajor:[0,1,2,2,2,2,2],neapolitanMinor:[0,1,2,2,2,1,3],hungarianMajor:[0,3,1,2,1,2,1],hungarianMinor:[0,2,1,3,1,1,3],hungarianGypsy:[0,1,3,1,2,1,3],spanish:[0,1,2,1,2,2,2],spanish8Tone:[0,1,2,1,1,1,2,2],spanishGypsy:[0,1,3,1,2,1,2],augmented:[0,3,1,3,1,3,1],dominantSuspended:[0,2,3,2,2,1,2],bebopMajor:[0,2,2,1,2,1,1,2],bebopDominant:[0,2,2,1,2,2,1,1],mystic:[0,2,2,2,3,2],overtone:[0,2,2,2,1,1,2],leadingTone:[0,2,2,2,2,2,1],hirojoshi:[0,2,1,4,1],japaneseA:[0,1,4,1,3],japaneseB:[0,2,3,1,3],oriental:[0,1,3,1,1,3,1],persian:[0,1,4,1,2,3],arabian:[0,2,2,1,1,2,2],balinese:[0,1,2,4,1],kumoi:[0,2,1,4,2,2],pelog:[0,1,2,3,1,1],algerian:[0,2,1,2,1,1,1,3],chinese:[0,4,2,1,4],mongolian:[0,2,2,3,2],egyptian:[0,2,3,2,3],romainian:[0,2,1,3,1,2,1],hindu:[0,2,2,1,2,1,2],insen:[0,1,4,2,3],iwato:[0,1,4,1,4],scottish:[0,2,3,2,2],yo:[0,3,2,2,3],istrian:[0,1,2,2,2,1,2],ukranianDorian:[0,2,1,3,1,2,1],petrushka:[0,1,3,2,1,3],ahavaraba:[0,1,3,1,2,1,2]};ot.halfDiminished=ot.minor7b5,ot.jewish=ot.spanish8Tone,ot.byzantine=ot.doubleHarmonic,ot.acoustic=ot.lydianDominant,ot.aeolian=ot.minor,ot.ionian=ot.major,Object.keys(ot).forEach(t=>Object.freeze(ot[t]));const at=/([A-G])(?![^(]*\))/g,rt=/(#|s|b)(?![^(]*\))/g,ct=/([0-9]+)(?![^(]*\))/g,ht=/(\([a-zA-Z]{2,}\))/g,lt=(e,n=!1)=>{try{var i=pt(e);if(i)return i;n||console.warn(`Ineffecient scale string formatting - ${e}. Get a performanc increase by using a valid format`)}catch(t){n||console.warn(`Ineffecient scale string formatting - ${e}. Get a performanc increase by using a valid format`)}let s=0,o="",a="";i=e.match(at)?.join("").split("");const t=e.match(rt)?.join("").split("");var r,n=e.match(ct)?.join("").split("");const c=e.match(ht)?.join("").split("");if(t&&(s=1<t.length?t.map(t=>j(t)).reduce((t,e)=>t+e):j(t[0])),n&&([r]=n,o=r),c&&(r=c.join(""),a=r),i){var[i]=i,h=i;let t=0;s&&(t=s);i=v(f(h)+t,y,d).value;let e=4;o&&(e=g(parseInt(o,10),b,_));let n=1;if(a&&(n=Object.keys(ot).findIndex(t=>t.toLowerCase().includes(a.toLowerCase().replace(/\(|\)/g,"")))),-1===n)throw console.log("UNKNOWN TEMPLATE",a),new Error("Unable to find template for scale "+a);h=ot[Object.keys(ot)[n]];return{key:i,octave:e,template:h}}throw new Error("Invalid Scale: "+e)},mt=()=>{const e={};var t=["A","B","C","D","E","F","G"],n=["b","#","s"];for(const a of Object.keys(ot))for(const r of t){e[`${r}(${a})`]=lt(r,!0);for(const c of n){var i=""+r+c+`(${a})`;e[i]=lt(i,!0)}for(let t=b;t<_;++t){var s=""+r+t+`(${a})`;e[s]=lt(s,!0);for(const h of n){var o=""+r+h+t+`(${a})`;e[o]=lt(o,!0)}}}return e};let ut={};const pt=t=>(ut=ut||mt(),ut[t]);r(()=>{ut=mt()});const ft=(e,n=!1)=>{try{var t=dt(JSON.stringify(e));if(t)return t}catch(t){n||console.warn(t)}const i=Object.keys(ot);var s=Object.values(ot);const o=[];for(let t=0;t<i.length;++t)X(s[t],e)&&o.push(i[t].charAt(0).toUpperCase()+i[t].slice(1));return o.join(" AKA ")},vt=()=>{const t={};for(const e of Object.values(ot))t[JSON.stringify(e)]=ft(e,!0);return t};let gt={};const dt=t=>(gt[t]||(gt=vt()),gt[t]);r(()=>{gt=vt()});class yt{constructor(t){t?("string"==typeof t&&(t=lt(t)),this.template=[...t?.template??st],this.key=t.key||0,this.octave=t.octave||4):(this.template=st,this.key=0,this.octave=4),this.generateNotes()}id=D();equals(t){return this._key===t._key&&this._octave===t._octave&&X(this._template,t._template)}copy(){const t=new yt({key:this.key,octave:this.octave,template:V(this.template)});return 0!==this._shiftedInterval&&t.shift(this._shiftedInterval),t}_key=0;get key(){return this._key}set key(t){t=v(t,y,d);this.octave=this.octave+t.numWraps,this._key=t.value,this.generateNotes()}_octave=4;get octave(){return this._octave}set octave(t){this._octave=g(t,b,_),this.generateNotes()}_template=[];get template(){return V(this._template)}set template(t){this._template=V(t),this._shiftedInterval=0,this.generateNotes()}_notes=[];get notes(){return this._notes}generateNotes(){var t,e=Q(this._template,-this._shiftedInterval);const n=[];let i=this.key;for(const o of e){var s=0===o?i=this.key:i+=o,s=new L({semitone:s,octave:this.octave});n.push(s)}0<this._shiftedInterval&&(t=n.splice(n.length-(this._shiftedInterval+1),1/0),n.unshift(...t)),this._shiftedInterval<0&&(t=n.splice(0,this._shiftedInterval),n.push(...t)),this._notes=n}getNoteNames(t=!0){return yt.scaleNoteNameLookup(this,t)}degree(t){t=v(t-1,0,this.notes.length-1);const e=this.notes[t.value].copy();return e.octave=this.octave+t.numWraps,e}relativeMajor(){return new yt({template:ot.major,key:this.degree(3).semitone,octave:this.octave})}relativeMinor(){return new yt({template:ot.minor,key:this.degree(6).semitone,octave:this.octave})}_shiftedInterval=0;_originalTemplate=[];shift(t=1){return 0===this._shiftedInterval&&(this._originalTemplate=V(this._template)),this._template=Q(this._template,t),this._shiftedInterval+=t,this.generateNotes(),this}shifted(t=1){const e=this.copy();return e.shift(t),e}unshift(){return 0!==this._shiftedInterval&&(0<this._originalTemplate.length&&(this._template=this._originalTemplate),this._shiftedInterval=0,this._originalTemplate=[],this.generateNotes()),this}unshifted(){const t=this.copy();return this._originalTemplate.length&&(t.template=this._originalTemplate),t.unshift(),t}shiftedInterval(){return this._shiftedInterval}ionian(){const t=this.copy();return t.template=ot.ionian,t}dorian(){const t=this.copy();return t.template=ot.dorian,t}phrygian(){const t=this.copy();return t.template=ot.phrygian,t}lydian(){const t=this.copy();return t.template=ot.lydian,t}mixolydian(){const t=this.copy();return t.template=ot.mixolydian,t}aeolian(){const t=this.copy();return t.template=ot.aeolian,t}locrian(){const t=this.copy();return t.template=ot.locrian,t}toString(){let t=ft(this._template);return t=t||this.getNoteNames().join(", "),""+i[this._key]+this._octave+`(${t})`}static scaleNoteNameLookup(t,e=!0){try{var n=`${t.key}-${t.octave}-`+JSON.stringify(t.template);const i=this._notesLookup[n];if(i)return i}catch(t){}let i=[...t.notes];var s;i=Q(i,-t.shiftedInterval());const o=["B#","Bs","Cb","E#","Es","Fb"],a=[];for(const c of i.map(t=>t.toString().split("/"))){for(const h of c)o.includes(h)&&(s=a.indexOf(h),a.splice(s,1));if(0!==a.length)if(1!==c.length){const l=["A","B","C","D","E","F","G","A","B","C","D","E","F","G"];var r=a[a.length-1][0],r=l.indexOf(r),r=l[r+1];c[0].includes(r)?a.push(c[0]):a.push(c[c.length-1])}else a.push(c[0]);else a.push(e?c[0]:c[c.length-1])}return Q(a,t.shiftedInterval())}static createNotesLookupTable(){const n={};for(let e=y;e<y+_;e++)for(let t=b;t<=_;t++)for(const s of Object.values(ot)){var i=new yt({key:e,template:s,octave:t});n[`${e}-${t}-`+JSON.stringify(s)]=yt.scaleNoteNameLookup(i)}return n}static _notesLookup={};static async init(){yt._notesLookup=yt.createNotesLookupTable()}}r(yt.init);const _t=[1,3,5];var bt=new yt;function jt(o,a,t){var e,r;void 0===a&&(a=50);var c=null!=(e=(t=void 0===t?{}:t).isImmediate)&&e,h=null!=(e=t.callback)&&e,l=t.maxWait,m=Date.now(),u=[];t=function(){var i=[].slice.call(arguments),s=this;return new Promise(function(t,e){var n=c&&void 0===r;if(void 0!==r&&clearTimeout(r),r=setTimeout(function(){var e;r=void 0,m=Date.now(),c||(e=o.apply(s,i),h&&h(e),u.forEach(function(t){return(0,t.resolve)(e)}),u=[])},function(){if(void 0!==l){var t=Date.now()-m;if(l<=t+a)return l-t}return a}()),n){n=o.apply(s,i);return h&&h(n),t(n)}u.push({resolve:t,reject:e})})};return t.cancel=function(e){void 0!==r&&clearTimeout(r),u.forEach(function(t){return(0,t.reject)(e)}),u=[]},t}const kt=/([A-G])(?=[^(]*\))/g,Nt=/(#|s|b)(?=[^(]*\))/g,wt=/([0-9]+)(?=[^(]*\))/g,At=/(min|maj|dim|aug)(?![^(]*\))/g,Tt=/([#|s|b]?[0-9]+)(?![^(]*\))/g,It=t=>{let n=0,i="",s="maj",o=[];var a=t.match(kt)?.join("").split("");const e=t.match(Nt)?.join("").split("");var r=t.match(wt)?.join("").split(""),c=t.match(At)?.join(""),t=t.match(Tt)?.join("").split("");e&&(n=1<e.length?e.map(t=>j(t)).reduce((t,e)=>t+e):j(e[0])),r&&([r]=r,i=r),c&&(s=c),t&&(o=t);const h=[];if(a){var[a]=a,l=a;let t=0;n&&(t=n);l=v(f(l)+t,y,d).value;let e=4;i&&(e=g(parseInt(i,10),b,_)),h.push(...Et[s]);for(const p of o){let t=0;"#"===p[0]||"s"===p[0]?(t=1,o.shift()):"b"===p[0]&&(t=-1,o.shift());var m,u=parseInt(p,10);h.includes(u)?(m=h.indexOf(u),h[m]=[u,t]):h.push([u,t])}return{root:l,octave:e,template:h}}throw new Error("Invalid chord name")};let St;r(()=>{St=(()=>{const e={};var t=["A","B","C","D","E","F","G"],n=["b","#","s"],i=["","2","3","4","5","6","7","9","11","13","b2","b3","b4","b5","b6","b7","b9","b11","b13","s2","s3","s4","s5","s6","s7","s9","s11","s13","#2","#3","#4","#5","#6","#7","#9","#11","#13","7s11","7#11","7b9","7#9","7b5","7#5","7b9b5","7#9#5","7b13","7#13","9#5","9b5","9#11","9b11","9#13","9b13","11#5","11b5","11#9","11b9","11#13","11b13"];for(const r of["maj","min","dim","aug","sus"])for(const c of i)for(const h of t){var s=`(${h})`+r+c;e[s]=It(s);for(const l of n){var o=`(${h}${l})`+r+c;e[o]=It(o);for(let t=b;t<=_;t++){var a=`(${h}${l}${t})`+r+c;e[a]=It(a)}}}return e})(),console.log(St)});const Et={maj:[1,3,5],maj4:[1,3,4,5],maj6:[1,3,5,6],maj69:[1,3,5,6,9],maj7:[1,3,5,7],maj9:[1,3,5,7,9],maj11:[1,3,5,7,9,11],maj13:[1,3,5,7,9,11,12],maj7s11:[1,3,5,7,[11,1]],majb5:[1,3,[5,-1]],min:[1,[3,-1],5],min4:[1,[3,-1],4,5],min6:[1,[3,-1],5,6],min7:[1,[3,-1],5,[7,-1]],minAdd9:[1,[3,-1],5,9],min69:[1,[3,-1],5,6,9],min9:[1,[3,-1],5,[7,-1],9],min11:[1,[3,-1],5,[7,-1],9,11],min13:[1,[3,-1],5,[7,-1],9,11,13],min7b5:[1,[3,-1],[5,-1],[7,-1]],dom7:[1,3,5,[7,-1]],dom9:[1,3,5,[7,-1],9],dom11:[1,3,5,[7,-1],9,11],dom13:[1,3,5,[7,-1],9,11,13],dom7s5:[1,3,[5,1],[7,-1]],dom7b5:[1,3,[5,-1],[7,-1]],dom7b9:[1,3,5,[7,-1],[9,-1]],dom7s9:[1,3,5,[7,-1],[9,1]],dom9s5:[1,3,[5,1],[7,-1],9],dom9b5:[1,3,[5,-1],[7,-1],9],dom7s5s9:[1,3,[5,1],[7,-1],[9,1]],dom7s5b9:[1,3,[5,1],[7,-1],[9,-1]],dom7s11:[1,3,5,[7,-1],[11,1]],dim:[1,[3,-1],[5,-1]],dim7:[1,[3,-1],[5,-1],[7,-2]],aug:[1,3,[5,1]],sus2:[1,2,5],sus4:[1,[4,-1],5],fifth:[1,5],b5:[1,[5,-1]],s11:[1,5,[11,1]]};Object.keys(Et).forEach(t=>Object.freeze(Et[t])),t.Chord=class Ot{constructor(t){t?(this._template=t.template??_t,this.octave=t.octave??4,this.root=t.root??0):(this._template=_t,this.octave=4,this.root=0),this._baseScale=new yt({key:this._root}),this.generateNotes()}id=D();_root=0;get root(){return this._root}set root(t){t=v(t,y,d),this._root=t.value,this._octave=this._octave+t.numWraps,this.generateNotes()}_baseScale=bt;get baseScale(){return this._baseScale}set baseScale(t){this._baseScale=t,this.generateNotes()}_octave=4;get octave(){return this._octave}set octave(t){this._octave=g(t,b,_),this.generateNotes()}_template=[];get template(){return[...this._template]}set template(t){this._template=[...t],this.generateNotes()}_notes=[];get notes(){return this._notes}_generateNotes(){console.log("generating notes"),this._notes=[];for(const i of this._template){let t=0,e=0;Array.isArray(i)?(t=i[0],e=i[1]):t=i;var n=t;const s=this._baseScale.degree(n);n=s.semitone,s.semitone=n+e,this._notes.push(s)}return this._notes}generateNotes=jt(this._generateNotes,10,{isImmediate:!0});getNoteNames(){const e=[];var n=this._baseScale.getNoteNames();for(const s of this._template){let t=0;t=Array.isArray(s)?s[0]:s;var i=n[t-1];e.push(i)}return e}copy(){return new Ot({root:this.root,octave:this.octave,template:[...this._template]})}equals(t){return this.root===t.root&&this.octave===t.octave&&X(this._template,t.template)}},t.ChordTemplates=Et,t.Instrument=class Gt{tuning;constructor(t=440){this.tuning=new x(t)}id=D();copy(){return new Gt(this.tuning.a4)}equals(t){return this.tuning.equals(t.tuning)}getFrequency(t){return this.tuning.freqLookup(t.octave,t.semitone)}getMidiKey(t){return this.tuning.midiKeyLookup(t.octave,t.semitone)}toString(){return`Instrument Tuning(${this.tuning.a4})`}},t.Modifier=o,t.Note=L,t.Scale=it,t.ScaleTemplates=q,t.Semitone=i,t.init=t=>{for(const e of a)e();t&&t()},t.initAsync=async t=>{for(const e of a)e();t&&t()},Object.defineProperty(t,"__esModule",{value:!0})});
