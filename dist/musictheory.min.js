!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).MusicTheory={})}(this,function(t){"use strict";var e;(o=e=e||{})[o.A=9]="A",o[o.As=10]="As",o[o.Bb=10]="Bb",o[o.B=11]="B",o[o.Bs=0]="Bs",o[o.Cb=11]="Cb",o[o.C=0]="C",o[o.Cs=1]="Cs",o[o.Db=1]="Db",o[o.D=2]="D",o[o.Ds=3]="Ds",o[o.Eb=3]="Eb",o[o.E=4]="E",o[o.Es=5]="Es",o[o.Fb=4]="Fb",o[o.F=5]="F",o[o.Fs=6]="Fs",o[o.Gb=6]="Gb",o[o.G=7]="G",o[o.Gs=8]="Gs",o[o.Ab=8]="Ab";const r={A:9,"As/Bb":10,"B/Cb":11,"Bs/C":0,"Cs/Db":1,D:2,"Ds/Eb":3,"E/Fb":4,"Es/F":5,"Fs/Gb":6,G:7,"Gs/Ab":8},l=t=>{if(!t||0===t.length||1<t.length)throw new Error("Invalid name");t=t[0].toUpperCase();return e[t]};var n,s=e;const u=(t,e,n)=>{let s=t,i=e,o=n;n<e&&(i=n,o=e);e=0-i;i+=e,o+=e,s+=e;let r=Math.trunc(s/o);0===r&&s<i&&(r=-1),1===r&&s===o&&(r=0);let a=0,c=0;return-1<=r&&r<=1&&(c=1),s<i?(a=s%o+c,s=o+a):s>o&&(a=s%o-c,s=i+a),s-=e,{value:s,numWraps:r}},m=(t,e,n)=>Math.max(Math.min(t,Math.max(e,n)),Math.min(e,n)),i=[1,3,4,6,8,10],p=11,v=0,f=9,g=0;(c=n=n||{})[c.FLAT=-1]="FLAT",c[c.NATURAL=0]="NATURAL",c[c.SHARP=1]="SHARP";const _=t=>{switch(t){case"b":case"flat":return n.FLAT;case"#":case"s":case"sharp":return n.SHARP;default:return n.NATURAL}};var o=n;const a=[];var c=t=>{if(!t)throw new Error("Initializer must be a function");a.push(t)};const h=/([A-G])/g,d=/(#|s|b)/g,y=/([0-9]+)/g,b=(e,n=!1)=>{try{var s=w(e);if(s)return s;n||console.warn(`Ineffecient note string formatting - ${e}. Get a performanc increase by using the format [A-G][#|s|b][0-9]`)}catch(t){n||console.warn(`Ineffecient note string formatting - ${e}. Get a performanc increase by using the format [A-G][#|s|b][0-9]`)}let i=0,o="";s=e.match(h)?.join("").split("");const t=e.match(d)?.join("").split("");n=e.match(y)?.join("").split("");if(t&&(i=1<t.length?t.map(t=>_(t)).reduce((t,e)=>t+e):_(t[0])),n&&([n]=n,o=n),s){var[s]=s,r=s;let t=0;i&&(t=i);r=u(l(r)+t,v,p).value;let e=4;return o&&(e=m(parseInt(o,10),g,f)),{semitone:r,octave:e}}throw new Error("Invalid note: "+e)},A=()=>{const n={};var s=["b","#","s"];for(const o of["A","B","C","D","E","F","G"]){n[o]=b(o,!0);for(let t=0;t<s.length;++t){var e=""+o+s[t];n[e]=b(e,!0)}for(let e=g;e<f;++e){var t=""+o+e;n[t]=b(t,!0);for(let t=0;t<s.length;++t){var i=""+o+s[t]+e;n[i]=b(i,!0)}}}return n};let k={};const w=t=>(k=k||A(),k[t]);c(()=>{k=A()});const j=["C","C#/Db","D","D#/Eb","E","F","F#/Gb","G","G#/Ab","A","A#/Bb","B"],N=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],T=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],G=()=>{const s={};for(let n=v;n<=p;++n)for(let e=v;e<=p;++e){let t="";i.includes(n)&&(t="-",u(n+1,v,p).value===e&&(t="b"),u(n-1,v,p).value===e&&(t="#")),s[n+"-"+e]=((t,e)=>{switch(e){case"#":return N[t];case"b":return T[t];case"-":default:return j[t]}})(n,t)}return s};let E={};c(()=>{E=G()});for(var I,D=256,S=[];D--;)S[D]=(D+256).toString(16).substring(1);function F(t){var e=0,t=t||11;if(!I||512<D+t)for(I="",D=0;e<256;e++)I+=S[256*Math.random()|0];return I.substring(D,D+++t)}class C{constructor(t){t?("string"==typeof t&&(t=b(t)),this.octave=t?.octave??4,this.semitone=t?.semitone??0,this._prevSemitone=this._tone):(this.octave=4,this.semitone=0)}id=F();_tone=0;_prevSemitone=0;get semitone(){return this._tone}set semitone(t){t=u(t,v,p);this._prevSemitone=this._tone,this._tone=t.value,this._octave=this._octave+t.numWraps}_octave=4;get octave(){return this._octave}set octave(t){this._octave=m(t,g,f)}sharp(){return new C({semitone:this.semitone,octave:this.octave}).sharpen()}sharpen(){return this.semitone=this.semitone+1,this}isSharp(){return!!i.includes(this.semitone)&&u(this.semitone+1,v,p).value!==this._prevSemitone}flat(){return new C({semitone:this.semitone,octave:this.octave}).flatten()}flatten(){return this.semitone=this.semitone-1,this}isFlat(){return!!i.includes(this.semitone)&&u(this.semitone-1,v,p).value!==this._prevSemitone}equals(t){return this.semitone===t.semitone&&this.octave===t.octave}copy(){return new C({semitone:this.semitone,octave:this.octave})}toString(){return t=this._tone+"-"+this._prevSemitone,E=E||G(),E[t]+(""+this._octave);var t}static A(t=4){return new C({semitone:s.A,octave:t})}static B(t=4){return new C({semitone:s.B,octave:t})}static C(t=4){return new C({semitone:s.C,octave:t})}static D(t=4){return new C({semitone:s.D,octave:t})}static E(t=4){return new C({semitone:s.E,octave:t})}static F(t=4){return new C({semitone:s.F,octave:t})}static G(t=4){return new C({semitone:s.G,octave:t})}}const B=12,L=12,O=(t=440)=>{const e={},n={};let s=0,i=0;for(s=0;s<10;++s)for(i=0;i<L;++i){var o=s+"-"+i,r=(r=s,a=i,B+r*L+a),a=2**((r-69)/12)*t;n[o]=r,e[o]=a}var r,a;return{freqLookup:e,midiLookup:n}};class M{constructor(t=440){this._a4=t,this.buildTables()}id=F();copy(){return new M(this._a4)}equals(t){return this._a4===t._a4}_a4=440;get a4(){return this._a4}set a4(t){this._a4=t,this.buildTables()}_midiKeyTable={};midiKeyLookup(t,e){return this._midiKeyTable[t+"-"+e]}_freqTable={};freqLookup(t,e){return this._freqTable[t+"-"+e]}buildTables(){var t=O(this._a4);this._midiKeyTable=t.midiLookup,this._freqTable=t.freqLookup}toString(){return`Tuning(${this._a4})`}}const $=[0,2,2,1,2,2,2];Object.freeze($);const q={wholeTone:[0,2,2,2,2,2,2],major:[0,2,2,1,2,2,2],major7s4s5:[0,2,2,2,2,1,2],dorian:[0,2,1,2,2,2,1],phrygian:[0,1,2,2,2,1,2],lydian:[0,2,2,2,1,2,2],lydianDominant:[0,2,2,2,1,2,1],mixolydian:[0,2,2,1,2,2,1],mixolydianFlat6:[0,2,2,1,2,1,2],locrian:[0,1,2,2,1,2,2],superLocrian:[0,1,2,1,2,2,2],minor:[0,2,1,2,2,1,2],minor7b9:[0,1,2,2,2,2,1],minor7b5:[0,2,1,2,1,2,2],harmonicMajor:[0,2,2,1,2,1,3],harmonicMinor:[0,2,1,2,2,1,3],doubleHarmonic:[0,1,3,1,2,1,3],melodicMinorAscending:[0,2,1,2,2,2,2],melodicMinorDescending:[0,2,2,1,2,2,1],majorPentatonic:[0,2,2,3,2],majorPentatonicBlues:[0,2,1,1,3,2],minorPentatonic:[0,3,2,2,3],minorPentatonicBlues:[0,3,2,1,1,3],b5Pentatonic:[0,3,2,1,4,2],minor6Pentatonic:[0,3,2,2,2,3],enigmaticMajor:[0,1,3,2,2,2,1],enigmaticMinor:[0,1,2,3,1,3,1],dim8Tone:[0,2,1,2,1,2,1,2],dom8Tone:[0,1,2,1,2,1,2,1],neapolitanMajor:[0,1,2,2,2,2,2],neapolitanMinor:[0,1,2,2,2,1,3],hungarianMajor:[0,3,1,2,1,2,1],hungarianMinor:[0,2,1,3,1,1,3],hungarianGypsy:[0,1,3,1,2,1,3],spanish:[0,1,2,1,2,2,2],spanish8Tone:[0,1,2,1,1,1,2,2],spanishGypsy:[0,1,3,1,2,1,2],augmented:[0,3,1,3,1,3,1],dominantSuspended:[0,2,3,2,2,1,2],bebopMajor:[0,2,2,1,2,1,1,2],bebopDominant:[0,2,2,1,2,2,1,1],mystic:[0,2,2,2,3,2],overtone:[0,2,2,2,1,1,2],leadingTone:[0,2,2,2,2,2,1],hirojoshi:[0,2,1,4,1],japaneseA:[0,1,4,1,3],japaneseB:[0,2,3,1,3],oriental:[0,1,3,1,1,3,1],persian:[0,1,4,1,2,3],arabian:[0,2,2,1,1,2,2],balinese:[0,1,2,4,1],kumoi:[0,2,1,4,2,2],pelog:[0,1,2,3,1,1],algerian:[0,2,1,2,1,1,1,3],chinese:[0,4,2,1,4],mongolian:[0,2,2,3,2],egyptian:[0,2,3,2,3],romainian:[0,2,1,3,1,2,1],hindu:[0,2,2,1,2,1,2],insen:[0,1,4,2,3],iwato:[0,1,4,1,4],scottish:[0,2,3,2,2],yo:[0,3,2,2,3],istrian:[0,1,2,2,2,1,2],ukranianDorian:[0,2,1,3,1,2,1],petrushka:[0,1,3,2,1,3],ahavaraba:[0,1,3,1,2,1,2]};q.halfDiminished=q.minor7b5,q.jewish=q.spanish8Tone,q.byzantine=q.doubleHarmonic,q.acoustic=q.lydianDominant,q.aeolian=q.minor,q.ionian=q.major,Object.keys(q).forEach(t=>Object.freeze(q[t]));const x=/([A-G])(?![^(]*\))/g,P=/(#|s|b)(?![^(]*\))/g,J=/([0-9]+)(?![^(]*\))/g,K=/(\([a-zA-Z]{2,}\))/g,U=(e,n=!1)=>{try{var s=z(e);if(s)return s;n||console.warn(`Ineffecient scale string formatting - ${e}. Get a performanc increase by using a valid format`)}catch(t){n||console.warn(`Ineffecient scale string formatting - ${e}. Get a performanc increase by using a valid format`)}let i=0,o="",r="";s=e.match(x)?.join("").split("");const t=e.match(P)?.join("").split("");var a,n=e.match(J)?.join("").split("");const c=e.match(K)?.join("").split("");if(t&&(i=1<t.length?t.map(t=>_(t)).reduce((t,e)=>t+e):_(t[0])),n&&([a]=n,o=a),c&&(a=c.join(""),r=a),s){var[s]=s,h=s;let t=0;i&&(t=i);s=u(l(h)+t,v,p).value;let e=4;o&&(e=m(parseInt(o,10),g,f));let n=1;if(r&&(n=Object.keys(q).findIndex(t=>t.toLowerCase().includes(r.toLowerCase().replace(/\(|\)/g,"")))),-1===n)throw console.log("UNKNOWN TEMPLATE",r),new Error("Unable to find template for scale "+r);h=q[Object.keys(q)[n]];return{key:s,octave:e,template:h}}throw new Error("Invalid Scale: "+e)},W=()=>{const e={};var t=["A","B","C","D","E","F","G"],n=["b","#","s"];for(const r of Object.keys(q))for(const a of t){e[`${a}(${r})`]=U(a,!0);for(const c of n){var s=""+a+c+`(${r})`;e[s]=U(s,!0)}for(let t=g;t<f;++t){var i=""+a+t+`(${r})`;e[i]=U(i,!0);for(const h of n){var o=""+a+h+t+`(${r})`;e[o]=U(o,!0)}}}return e};let R={};const z=t=>(R=R||W(),R[t]);c(()=>{R=W()});const H=(t,e=1)=>{if(e>(t=[...t]).length||e<0-t.length)throw new Error("shift: distance is greater than array length");var n;return 0<e&&(n=t.splice(t.length-e,1/0),t.unshift(...n)),e<0&&(e=t.splice(0,e),t.push(...e)),t},Z=t=>JSON.parse(JSON.stringify(t)),Q=(t,e)=>{return JSON.stringify(t)===JSON.stringify(e)},V=(e,n=!1)=>{try{var t=tt(JSON.stringify(e));if(t)return t}catch(t){n||console.warn(t)}const s=Object.keys(q);var i=Object.values(q);const o=[];for(let t=0;t<s.length;++t)Q(i[t],e)&&o.push(s[t].charAt(0).toUpperCase()+s[t].slice(1));return o.join(" AKA ")},X=()=>{const t={};for(const e of Object.values(q))t[JSON.stringify(e)]=V(e,!0);return t};let Y={};const tt=t=>(Y[t]||(Y=X()),Y[t]);c(()=>{Y=X()});class et{constructor(t){t?("string"==typeof t&&(t=U(t)),this.template=Z(t.template)||$,this.key=t.key||0,this.octave=t.octave||4):(this.template=$,this.key=0,this.octave=4),this.generateNotes()}id=F();equals(t){return this._key===t._key&&this._octave===t._octave&&Q(this._template,t._template)}copy(){const t=new et({key:this.key,octave:this.octave,template:Z(this.template)});return 0!==this._shiftedInterval&&t.shift(this._shiftedInterval),t}_key=0;get key(){return this._key}set key(t){t=u(t,v,p);this.octave=this.octave+t.numWraps,this._key=t.value,this.generateNotes()}_octave=4;get octave(){return this._octave}set octave(t){this._octave=m(t,g,f),this.generateNotes()}_template=[];get template(){return Z(this._template)}set template(t){this._template=Z(t),this._shiftedInterval=0,this.generateNotes()}_notes=[];get notes(){return this._notes}generateNotes(){var t,e=H(this._template,-this._shiftedInterval);const n=[];let s=this.key;for(const o of e){var i=0===o?s=this.key:s+=o,i=new C({semitone:i,octave:this.octave});n.push(i)}0<this._shiftedInterval&&(t=n.splice(n.length-(this._shiftedInterval+1),1/0),n.unshift(...t)),this._shiftedInterval<0&&(t=n.splice(0,this._shiftedInterval),n.push(...t)),this._notes=n}getNoteNames(t=!0){return et.scaleNoteNameLookup(this,t)}degree(t){t=u(t-1,0,this.notes.length-1);const e=this.notes[t.value].copy();return e.octave=this.octave+t.numWraps,e}relativeMajor(){return new et({template:q.major,key:this.degree(3).semitone,octave:this.octave})}relativeMinor(){return new et({template:q.minor,key:this.degree(6).semitone,octave:this.octave})}_shiftedInterval=0;_originalTemplate=[];shift(t=1){return 0===this._shiftedInterval&&(this._originalTemplate=Z(this._template)),this._template=H(this._template,t),this._shiftedInterval+=t,this.generateNotes(),this}shifted(t=1){const e=this.copy();return e.shift(t),e}unshift(){return 0!==this._shiftedInterval&&(0<this._originalTemplate.length&&(this._template=this._originalTemplate),this._shiftedInterval=0,this._originalTemplate=[],this.generateNotes()),this}unshifted(){const t=this.copy();return this._originalTemplate.length&&(t.template=this._originalTemplate),t.unshift(),t}shiftedInterval(){return this._shiftedInterval}ionian(){const t=this.copy();return t.template=q.ionian,t}dorian(){const t=this.copy();return t.template=q.dorian,t}phrygian(){const t=this.copy();return t.template=q.phrygian,t}lydian(){const t=this.copy();return t.template=q.lydian,t}mixolydian(){const t=this.copy();return t.template=q.mixolydian,t}aeolian(){const t=this.copy();return t.template=q.aeolian,t}locrian(){const t=this.copy();return t.template=q.locrian,t}toString(){let t=V(this._template);return t=t||this.getNoteNames().join(", "),""+s[this._key]+this._octave+`(${t})`}static scaleNoteNameLookup(t,e=!0){try{var n=`${t.key}-${t.octave}-`+JSON.stringify(t.template);const s=this._notesLookup[n];if(s)return s}catch(t){}let s=[...t.notes];var i;s=H(s,-t.shiftedInterval());const o=["B#","Bs","Cb","E#","Es","Fb"],r=[];for(const c of s.map(t=>t.toString().split("/"))){for(const h of c)o.includes(h)&&(i=r.indexOf(h),r.splice(i,1));if(0!==r.length)if(1!==c.length){const l=["A","B","C","D","E","F","G","A","B","C","D","E","F","G"];var a=r[r.length-1][0],a=l.indexOf(a),a=l[a+1];c[0].includes(a)?r.push(c[0]):r.push(c[c.length-1])}else r.push(c[0]);else r.push(e?c[0]:c[c.length-1])}return H(r,t.shiftedInterval())}static createNotesLookupTable(){const n={};for(let e=v;e<v+f;e++)for(let t=g;t<=f;t++)for(const i of Object.values(q)){var s=new et({key:e,template:i,octave:t});n[`${e}-${t}-`+JSON.stringify(i)]=et.scaleNoteNameLookup(s)}return n}static _notesLookup={};static async init(){et._notesLookup=et.createNotesLookupTable()}}c(et.init);const nt=[1,3,5];t.Chord=class st{constructor(t){t?(this._template=t.template??nt,this.octave=t.octave??4,this.root=t.root??0):(this._template=nt,this.octave=4,this.root=0),this.generateNotes()}id=F();_root=0;get root(){return this._root}set root(t){t=u(t,v,p),this._root=t.value,this._octave=this._octave+t.numWraps,this.generateNotes()}_octave=4;get octave(){return this._octave}set octave(t){this._octave=m(t,g,f),this.generateNotes()}_template=[];get template(){return[...this._template]}set template(t){this._template=[...t],this.generateNotes()}_notes=[];get notes(){return this._notes}generateNotes(){this._notes=[];const n=["C","D","E","F","G","A","B"];var t=((e,t)=>{const n=Object.values(r);var s=n.findIndex(t=>t===e);const i=Object.keys(r)[s];if(1===(s=i.split("/")).length)return s[0];if(!t)return i;for(const o of s)if(o.includes(t[0]))return o;return i})(this._root);console.log(t);var s=n.indexOf(t?.[0]);console.log(s);for(const o of this._template){let t=0,e=0;Array.isArray(o)?(t=o?.[0]??0,e=o?.[1]??0):t=o;var i=u(s+t-1,0,7),i=new C({semitone:l(n[i.value])+e,octave:this._octave+i.numWraps});this._notes.push(i)}}copy(){return new st({root:this.root,octave:this.octave})}equals(t){return this.root===t.root&&this.octave===t.octave}},t.Instrument=class it{tuning;constructor(t=440){this.tuning=new M(t)}id=F();copy(){return new it(this.tuning.a4)}equals(t){return this.tuning.equals(t.tuning)}getFrequency(t){return this.tuning.freqLookup(t.octave,t.semitone)}getMidiKey(t){return this.tuning.midiKeyLookup(t.octave,t.semitone)}toString(){return`Instrument Tuning(${this.tuning.a4})`}},t.Modifier=o,t.Note=C,t.Scale=et,t.ScaleTemplates=q,t.Semitone=s,t.init=t=>{for(const e of a)e();t&&t()},t.initAsync=async t=>{for(const e of a)e();t&&t()},Object.defineProperty(t,"__esModule",{value:!0})});
