!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).MusicTheory={})}(this,function(e){"use strict";for(var n,r=256,s=[],o=256;r--;)s[r]=(r+256).toString(16).substring(1);var t;(d=t=t||{})[d.A=9]="A",d[d.As=10]="As",d[d.Bb=10]="Bb",d[d.B=11]="B",d[d.Bs=0]="Bs",d[d.Cb=11]="Cb",d[d.C=0]="C",d[d.Cs=1]="Cs",d[d.Db=1]="Db",d[d.D=2]="D",d[d.Ds=3]="Ds",d[d.Eb=3]="Eb",d[d.E=4]="E",d[d.Es=5]="Es",d[d.Fb=4]="Fb",d[d.F=5]="F",d[d.Fs=6]="Fs",d[d.Gb=6]="Gb",d[d.G=7]="G",d[d.Gs=8]="Gs",d[d.Ab=8]="Ab";const a=e=>{if(!e||0===e.length||1<e.length)throw new Error("Invalid name");e=e[0].toUpperCase();return t[e]};var i,c=t;const u=(e,t,n)=>{let r=e,s=t,o=n;n<t&&(s=n,o=t);t=0-s;s+=t,o+=t,r+=t;let i=Math.trunc(r/o);0===i&&r<s&&(i=-1),1===i&&r===o&&(i=0);let a=0,c=0;return-1<=i&&i<=1&&(c=1),r<s?(a=r%o+c,r=o+a):r>o&&(a=r%o-c,r=s+a),r-=t,{value:r,numWraps:i}},h=(e,t,n)=>Math.max(Math.min(e,Math.max(t,n)),Math.min(t,n)),l=[1,3,4,6,8,10],v=11,f=0,m=9,p=0;(S=i=i||{})[S.FLAT=-1]="FLAT",S[S.NATURAL=0]="NATURAL",S[S.SHARP=1]="SHARP";const b=e=>{switch(e){case"b":case"flat":return i.FLAT;case"#":case"s":case"sharp":return i.SHARP;default:return i.NATURAL}};var d=i;const A=/([A-G])/g,g=/(#|s|b)/g,_=/([0-9]*)/g,y=(t,n=!1)=>{try{var r=G[t];if(r)return r;n||console.warn(`Ineffecient note string formatting - ${t}. Get a performanc increase by using the format [A-G][#|s|b][0-9]`)}catch(e){n||console.warn(`Ineffecient note string formatting - ${t}. Get a performanc increase by using the format [A-G][#|s|b][0-9]`)}let s=0,o="";r=t.match(A)?.join("").split("");const e=t.match(g)?.join("").split("");n=t.match(_)?.join("").split("");if(e&&(s=1<e.length?e.reduce((e,t)=>{return(e="string"==typeof e?b(e):e)+b(t)}):b(e[0])),n&&([n]=n,o=n),r){var[r]=r,i=r;let e=0;s&&(e=s);i=u(a(i)+e,f,v).value;let t=4;return o&&(t=h(parseInt(o),p,m)),{semitone:i,octave:t}}throw new Error("Invalid note: "+t)};const G=(()=>{const n={};var r=["b","#","s"];for(const o of["A","B","C","D","E","F","G"]){n[o]=y(o,!0);for(let e=0;e<r.length;++e){var t=""+o+r[e];n[t]=y(t,!0)}for(let t=p;t<m;++t){var e=""+o+t;n[e]=y(e,!0);for(let e=0;e<r.length;++e){var s=""+o+r[e]+t;n[s]=y(s,!0)}}}return n})(),w=["C","C#/Db","D","D#/Eb","E","F","F#/Gb","G","G#/Ab","A","A#/Bb","B"],F=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],D=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"];var E;const C=(()=>{const r={};for(let n=f;n<=v;++n)for(let t=f;t<=v;++t){let e="";l.includes(n)&&(e="-",u(n+1,f,v).value===t&&(e="b"),u(n-1,f,v).value===t&&(e="#")),r[n+"-"+t]=((e,t)=>{switch(t){case"#":return F[e];case"b":return D[e];case"-":default:return w[e]}})(n,e)}return r})();let B=E=class{constructor(e){e?("string"==typeof e&&(e=y(e)),this.octave=e?.octave??4,this.semitone=e?.semitone??0,this._prevSemitone=this._tone):(this.octave=4,this.semitone=0)}id(e){return""}_tone=0;_prevSemitone=0;get semitone(){return this._tone}set semitone(e){e=u(e,f,v);this._prevSemitone=this._tone,this._tone=e.value,this._octave=this._octave+e.numWraps}_octave=4;get octave(){return this._octave}set octave(e){this._octave=h(e,p,m)}sharp(){return new E({semitone:this.semitone,octave:this.octave}).sharpen()}sharpen(){return this.semitone=this.semitone+1,this}isSharp(){return!!l.includes(this.semitone)&&u(this.semitone+1,f,v).value!==this._prevSemitone}flat(){return new E({semitone:this.semitone,octave:this.octave}).flatten()}flatten(){return this.semitone=this.semitone-1,this}isFlat(){return!!l.includes(this.semitone)&&u(this.semitone-1,f,v).value!==this._prevSemitone}equals(e){return this.semitone===e.semitone&&this.octave===e.octave}copy(){return new E({semitone:this.semitone,octave:this.octave})}toString(){return C[this._tone+"-"+this._prevSemitone]+(""+this._octave)}static A(e=4){return new E({semitone:c.A,octave:e})}static B(e=4){return new E({semitone:c.B,octave:e})}static C(e=4){return new E({semitone:c.C,octave:e})}static D(e=4){return new E({semitone:c.D,octave:e})}static E(e=4){return new E({semitone:c.E,octave:e})}static F(e=4){return new E({semitone:c.F,octave:e})}static G(e=4){return new E({semitone:c.G,octave:e})}};B=E=function(e,t,n,r){var s,o=arguments.length,i=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;0<=a;a--)(s=e[a])&&(i=(o<3?s(i):3<o?s(t,n,i):s(t,n))||i);return 3<o&&i&&Object.defineProperty(t,n,i),i}([t=>{t.prototype.id=e=>(void 0===t.prototype._id&&(t.prototype._id=function(e){var t=0,e=e||11;if(!n||2*o<r+e)for(n="",r=0;t<o;t++)n+=s[256*Math.random()|0];return n.substring(r,r+++e)}()),e&&(t.prototype._id=e),t.prototype._id)}],B);var S=B;e.Modifier=d,e.Note=S,e.Semitone=c,e.wrap=u,Object.defineProperty(e,"__esModule",{value:!0})});
