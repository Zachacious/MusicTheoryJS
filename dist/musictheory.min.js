!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).MusicTheory={})}(this,function(t){"use strict";var e;(r=e=e||{})[r.A=9]="A",r[r.As=10]="As",r[r.Bb=10]="Bb",r[r.B=11]="B",r[r.Bs=0]="Bs",r[r.Cb=11]="Cb",r[r.C=0]="C",r[r.Cs=1]="Cs",r[r.Db=1]="Db",r[r.D=2]="D",r[r.Ds=3]="Ds",r[r.Eb=3]="Eb",r[r.E=4]="E",r[r.Es=5]="Es",r[r.Fb=4]="Fb",r[r.F=5]="F",r[r.Fs=6]="Fs",r[r.Gb=6]="Gb",r[r.G=7]="G",r[r.Gs=8]="Gs",r[r.Ab=8]="Ab";const f=t=>{if(!t||0===t.length||1<t.length)throw new Error("Invalid name");t=t[0].toUpperCase();return e[t]};var i,n=e;const v=(t,e,i)=>{let n=t,s=e,a=i;i<e&&(s=i,a=e);e=0-s;s+=e,a+=e,n+=e;let o=Math.trunc(n/a);0===o&&n<s&&(o=-1),1===o&&n===a&&(o=0);let r=0,h=0;return-1<=o&&o<=1&&(h=1),n<s?(r=n%a+h,n=a+r):n>a&&(r=n%a-h,n=s+r),n-=e,{value:n,numWraps:o}},g=(t,e,i)=>Math.max(Math.min(t,Math.max(e,i)),Math.min(e,i)),s=[1,3,4,6,8,10],_=11,d=0,y=9,b=0;(_t=i=i||{})[_t.FLAT=-1]="FLAT",_t[_t.NATURAL=0]="NATURAL",_t[_t.SHARP=1]="SHARP";const j=t=>{switch(t){case"b":case"flat":return i.FLAT;case"#":case"s":case"sharp":return i.SHARP;default:return i.NATURAL}};var a=i;const o=[];var r=t=>{if(!t)throw new Error("Initializer must be a function");o.push(t)};const h=/([A-G])/g,l=/(#|s|b)/g,c=/([0-9]+)/g,m=(e,i=!1)=>{try{var n=k(e);if(n)return n;i||console.warn(`Ineffecient note string formatting - ${e}. Get a performanc increase by using the format [A-G][#|s|b][0-9]`)}catch(t){i||console.warn(`Ineffecient note string formatting - ${e}. Get a performanc increase by using the format [A-G][#|s|b][0-9]`)}let s=0,a="";n=e.match(h)?.join("").split("");const t=e.match(l)?.join("").split("");i=e.match(c)?.join("").split("");if(t&&(s=1<t.length?t.map(t=>j(t)).reduce((t,e)=>t+e):j(t[0])),i&&([i]=i,a=i),n){var[n]=n,o=n;let t=0;s&&(t=s);o=v(f(o)+t,d,_).value;let e=4;return a&&(e=g(parseInt(a,10),b,y)),{semitone:o,octave:e}}throw new Error("Invalid note: "+e)},p=()=>{const i={};var n=["b","#","s"];for(const a of["A","B","C","D","E","F","G"]){i[a]=m(a,!0);for(let t=0;t<n.length;++t){var e=""+a+n[t];i[e]=m(e,!0)}for(let e=b;e<y;++e){var t=""+a+e;i[t]=m(t,!0);for(let t=0;t<n.length;++t){var s=""+a+n[t]+e;i[s]=m(s,!0)}}}return i};let u={};const k=t=>(u=u||p(),u[t]);r(()=>{u=p()});const A=["C","C#/Db","D","D#/Eb","E","F","F#/Gb","G","G#/Ab","A","A#/Bb","B"],w=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],N=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],T=()=>{const n={};for(let i=d;i<=_;++i)for(let e=d;e<=_;++e){let t="";s.includes(i)&&(t="-",v(i+1,d,_).value===e&&(t="b"),v(i-1,d,_).value===e&&(t="#")),n[i+"-"+e]=((t,e)=>{switch(e){case"#":return w[t];case"b":return N[t];case"-":default:return A[t]}})(i,t)}return n};let I={};r(()=>{I=T()});for(var D,S=256,O=[];S--;)O[S]=(S+256).toString(16).substring(1);function E(t){var e=0,t=t||11;if(!D||512<S+t)for(D="",S=0;e<256;e++)D+=O[256*Math.random()|0];return D.substring(S,S+++t)}class G{constructor(t){t?("string"==typeof t&&(t=m(t)),this.octave=t?.octave??4,this.semitone=t?.semitone??0,this._prevSemitone=this._tone):(this.octave=4,this.semitone=0)}id=E();_tone=0;_prevSemitone=0;get semitone(){return this._tone}set semitone(t){t=v(t,d,_);this._prevSemitone=this._tone,this._tone=t.value,this._octave=this._octave+t.numWraps}_octave=4;get octave(){return this._octave}set octave(t){this._octave=g(t,b,y)}sharp(){return new G({semitone:this.semitone,octave:this.octave}).sharpen()}sharpen(){return this.semitone=this.semitone+1,this}isSharp(){return!!s.includes(this.semitone)&&v(this.semitone+1,d,_).value!==this._prevSemitone}flat(){return new G({semitone:this.semitone,octave:this.octave}).flatten()}flatten(){return this.semitone=this.semitone-1,this}isFlat(){return!!s.includes(this.semitone)&&v(this.semitone-1,d,_).value!==this._prevSemitone}equals(t){return this.semitone===t.semitone&&this.octave===t.octave}copy(){return new G({semitone:this.semitone,octave:this.octave})}toString(){return t=this._tone+"-"+this._prevSemitone,I=I||T(),I[t]+(""+this._octave);var t}static A(t=4){return new G({semitone:n.A,octave:t})}static B(t=4){return new G({semitone:n.B,octave:t})}static C(t=4){return new G({semitone:n.C,octave:t})}static D(t=4){return new G({semitone:n.D,octave:t})}static E(t=4){return new G({semitone:n.E,octave:t})}static F(t=4){return new G({semitone:n.F,octave:t})}static G(t=4){return new G({semitone:n.G,octave:t})}}const L=12,M=12,$=(t=440)=>{const e={},i={};let n=0,s=0;for(n=0;n<10;++n)for(s=0;s<M;++s){var a=n+"-"+s,o=(o=n,r=s,L+o*M+r),r=2**((o-69)/12)*t;i[a]=o,e[a]=r}var o,r;return{freqLookup:e,midiLookup:i}};class C{constructor(t=440){this._a4=t,this.buildTables()}id=E();copy(){return new C(this._a4)}equals(t){return this._a4===t._a4}_a4=440;get a4(){return this._a4}set a4(t){this._a4=t,this.buildTables()}_midiKeyTable={};midiKeyLookup(t,e){return this._midiKeyTable[t+"-"+e]}_freqTable={};freqLookup(t,e){return this._freqTable[t+"-"+e]}buildTables(){var t=$(this._a4);this._midiKeyTable=t.midiLookup,this._freqTable=t.freqLookup}toString(){return`Tuning(${this._a4})`}}const B=[0,2,2,1,2,2,2];Object.freeze(B);const F={wholeTone:[0,2,2,2,2,2,2],major:[0,2,2,1,2,2,2],major7s4s5:[0,2,2,2,2,1,2],dorian:[0,2,1,2,2,2,1],phrygian:[0,1,2,2,2,1,2],lydian:[0,2,2,2,1,2,2],lydianDominant:[0,2,2,2,1,2,1],mixolydian:[0,2,2,1,2,2,1],mixolydianFlat6:[0,2,2,1,2,1,2],locrian:[0,1,2,2,1,2,2],superLocrian:[0,1,2,1,2,2,2],minor:[0,2,1,2,2,1,2],minor7b9:[0,1,2,2,2,2,1],minor7b5:[0,2,1,2,1,2,2],harmonicMajor:[0,2,2,1,2,1,3],harmonicMinor:[0,2,1,2,2,1,3],doubleHarmonic:[0,1,3,1,2,1,3],melodicMinorAscending:[0,2,1,2,2,2,2],melodicMinorDescending:[0,2,2,1,2,2,1],majorPentatonic:[0,2,2,3,2],majorPentatonicBlues:[0,2,1,1,3,2],minorPentatonic:[0,3,2,2,3],minorPentatonicBlues:[0,3,2,1,1,3],b5Pentatonic:[0,3,2,1,4,2],minor6Pentatonic:[0,3,2,2,2,3],enigmaticMajor:[0,1,3,2,2,2,1],enigmaticMinor:[0,1,2,3,1,3,1],dim8Tone:[0,2,1,2,1,2,1,2],dom8Tone:[0,1,2,1,2,1,2,1],neapolitanMajor:[0,1,2,2,2,2,2],neapolitanMinor:[0,1,2,2,2,1,3],hungarianMajor:[0,3,1,2,1,2,1],hungarianMinor:[0,2,1,3,1,1,3],hungarianGypsy:[0,1,3,1,2,1,3],spanish:[0,1,2,1,2,2,2],spanish8Tone:[0,1,2,1,1,1,2,2],spanishGypsy:[0,1,3,1,2,1,2],augmented:[0,3,1,3,1,3,1],dominantSuspended:[0,2,3,2,2,1,2],bebopMajor:[0,2,2,1,2,1,1,2],bebopDominant:[0,2,2,1,2,2,1,1],mystic:[0,2,2,2,3,2],overtone:[0,2,2,2,1,1,2],leadingTone:[0,2,2,2,2,2,1],hirojoshi:[0,2,1,4,1],japaneseA:[0,1,4,1,3],japaneseB:[0,2,3,1,3],oriental:[0,1,3,1,1,3,1],persian:[0,1,4,1,2,3],arabian:[0,2,2,1,1,2,2],balinese:[0,1,2,4,1],kumoi:[0,2,1,4,2,2],pelog:[0,1,2,3,1,1],algerian:[0,2,1,2,1,1,1,3],chinese:[0,4,2,1,4],mongolian:[0,2,2,3,2],egyptian:[0,2,3,2,3],romainian:[0,2,1,3,1,2,1],hindu:[0,2,2,1,2,1,2],insen:[0,1,4,2,3],iwato:[0,1,4,1,4],scottish:[0,2,3,2,2],yo:[0,3,2,2,3],istrian:[0,1,2,2,2,1,2],ukranianDorian:[0,2,1,3,1,2,1],petrushka:[0,1,3,2,1,3],ahavaraba:[0,1,3,1,2,1,2]};F.halfDiminished=F.minor7b5,F.jewish=F.spanish8Tone,F.byzantine=F.doubleHarmonic,F.acoustic=F.lydianDominant,F.aeolian=F.minor,F.ionian=F.major,Object.keys(F).forEach(t=>Object.freeze(F[t]));const x=/([A-G])(?![^(]*\))/g,P=/(#|s|b)(?![^(]*\))/g,q=/([0-9]+)(?![^(]*\))/g,J=/(\([a-zA-Z]{2,}\))/g,z=(e,i=!1)=>{try{var n=W(e);if(n)return n;i||console.warn(`Ineffecient scale string formatting - ${e}. Get a performanc increase by using a valid format`)}catch(t){i||console.warn(`Ineffecient scale string formatting - ${e}. Get a performanc increase by using a valid format`)}let s=0,a="",o="";n=e.match(x)?.join("").split("");const t=e.match(P)?.join("").split("");var r,i=e.match(q)?.join("").split("");const h=e.match(J)?.join("").split("");if(t&&(s=1<t.length?t.map(t=>j(t)).reduce((t,e)=>t+e):j(t[0])),i&&([r]=i,a=r),h&&(r=h.join(""),o=r),n){var[n]=n,l=n;let t=0;s&&(t=s);n=v(f(l)+t,d,_).value;let e=4;a&&(e=g(parseInt(a,10),b,y));let i=1;if(o&&(i=Object.keys(F).findIndex(t=>t.toLowerCase().includes(o.toLowerCase().replace(/\(|\)/g,"")))),-1===i)throw console.log("UNKNOWN TEMPLATE",o),new Error("Unable to find template for scale "+o);l=F[Object.keys(F)[i]];return{key:n,octave:e,template:l}}throw new Error("Invalid Scale: "+e)},K=()=>{const e={};var t=["A","B","C","D","E","F","G"],i=["b","#","s"];for(const o of Object.keys(F))for(const r of t){e[`${r}(${o})`]=z(r,!0);for(const h of i){var n=""+r+h+`(${o})`;e[n]=z(n,!0)}for(let t=b;t<y;++t){var s=""+r+t+`(${o})`;e[s]=z(s,!0);for(const l of i){var a=""+r+l+t+`(${o})`;e[a]=z(a,!0)}}}return e};let U={};const W=t=>(U=U||K(),U[t]);r(()=>{U=K()});const H=(t,e=1)=>{if(e>(t=[...t]).length||e<0-t.length)throw new Error("shift: distance is greater than array length");var i;return 0<e&&(i=t.splice(t.length-e,1/0),t.unshift(...i)),e<0&&(e=t.splice(0,e),t.push(...e)),t},R=t=>JSON.parse(JSON.stringify(t)),Z=(t,e)=>{return JSON.stringify(t)===JSON.stringify(e)},Q=(e,i=!1)=>{try{var t=Y(JSON.stringify(e));if(t)return t}catch(t){i||console.warn(t)}const n=Object.keys(F);var s=Object.values(F);const a=[];for(let t=0;t<n.length;++t)Z(s[t],e)&&a.push(n[t].charAt(0).toUpperCase()+n[t].slice(1));return a.join(" AKA ")},V=()=>{const t={};for(const e of Object.values(F))t[JSON.stringify(e)]=Q(e,!0);return t};let X={};const Y=t=>(X[t]||(X=V()),X[t]);r(()=>{X=V()});class tt{constructor(t){t?("string"==typeof t&&(t=z(t)),this.template=[...t?.template??B],this.key=t.key||0,this.octave=t.octave||4):(this.template=B,this.key=0,this.octave=4),this.generateNotes()}id=E();equals(t){return this._key===t._key&&this._octave===t._octave&&Z(this._template,t._template)}copy(){const t=new tt({key:this.key,octave:this.octave,template:R(this.template)});return 0!==this._shiftedInterval&&t.shift(this._shiftedInterval),t}_key=0;get key(){return this._key}set key(t){t=v(t,d,_);this.octave=this.octave+t.numWraps,this._key=t.value,this.generateNotes()}_octave=4;get octave(){return this._octave}set octave(t){this._octave=g(t,b,y),this.generateNotes()}_template=[];get template(){return R(this._template)}set template(t){this._template=R(t),this._shiftedInterval=0,this.generateNotes()}_notes=[];get notes(){return this._notes}generateNotes(){var t,e=H(this._template,-this._shiftedInterval);const i=[];let n=this.key;for(const a of e){var s=0===a?n=this.key:n+=a,s=new G({semitone:s,octave:this.octave});i.push(s)}0<this._shiftedInterval&&(t=i.splice(i.length-(this._shiftedInterval+1),1/0),i.unshift(...t)),this._shiftedInterval<0&&(t=i.splice(0,this._shiftedInterval),i.push(...t)),this._notes=i}getNoteNames(t=!0){return tt.scaleNoteNameLookup(this,t)}degree(t){t=v(t-1,0,this.notes.length-1);const e=this.notes[t.value].copy();return e.octave=this.octave+t.numWraps,console.log(e),e}relativeMajor(){return new tt({template:F.major,key:this.degree(3).semitone,octave:this.octave})}relativeMinor(){return new tt({template:F.minor,key:this.degree(6).semitone,octave:this.octave})}_shiftedInterval=0;_originalTemplate=[];shift(t=1){return 0===this._shiftedInterval&&(this._originalTemplate=R(this._template)),this._template=H(this._template,t),this._shiftedInterval+=t,this.generateNotes(),this}shifted(t=1){const e=this.copy();return e.shift(t),e}unshift(){return 0!==this._shiftedInterval&&(0<this._originalTemplate.length&&(this._template=this._originalTemplate),this._shiftedInterval=0,this._originalTemplate=[],this.generateNotes()),this}unshifted(){const t=this.copy();return this._originalTemplate.length&&(t.template=this._originalTemplate),t.unshift(),t}shiftedInterval(){return this._shiftedInterval}ionian(){const t=this.copy();return t.template=F.ionian,t}dorian(){const t=this.copy();return t.template=F.dorian,t}phrygian(){const t=this.copy();return t.template=F.phrygian,t}lydian(){const t=this.copy();return t.template=F.lydian,t}mixolydian(){const t=this.copy();return t.template=F.mixolydian,t}aeolian(){const t=this.copy();return t.template=F.aeolian,t}locrian(){const t=this.copy();return t.template=F.locrian,t}toString(){let t=Q(this._template);return t=t||this.getNoteNames().join(", "),""+n[this._key]+this._octave+`(${t})`}static scaleNoteNameLookup(t,e=!0){try{var i=`${t.key}-${t.octave}-`+JSON.stringify(t.template);const n=this._notesLookup[i];if(n)return n}catch(t){}let n=[...t.notes];n=H(n,-t.shiftedInterval());const s=n.map(t=>t.toString().split("/"));var a,o,r,h=n.map(t=>t.octave);const l=["B#","Bs","Cb","E#","Es","Fb"],c=[];for([a,o]of s.entries()){for(const u of o)l.includes(u)&&(r=c.indexOf(u),c.splice(r,1));if(0!==c.length)if(1!==o.length){const f=["A","B","C","D","E","F","G","A","B","C","D","E","F","G"];var m,p=c[c.length-1][0],p=f.indexOf(p),p=f[p+1];o[0].includes(p)?(m=o[0].match(/\d/g),c.push(o[0]+(m?"":h[a]))):(m=o[o.length-1].match(/\d/g),c.push(o[o.length-1]+(m?"":h[a])))}else c.push(o[0]);else c.push(e?o[0]:o[o.length-1])}return H(c,t.shiftedInterval())}static createNotesLookupTable(){const i={};for(let e=d;e<d+y;e++)for(let t=b;t<=y;t++)for(const s of Object.values(F)){var n=new tt({key:e,template:s,octave:t});i[`${e}-${t}-`+JSON.stringify(s)]=tt.scaleNoteNameLookup(n)}return i}static _notesLookup={};static async init(){tt._notesLookup=tt.createNotesLookupTable()}}r(tt.init);const et=[0,2,2,1,2,2,2];Object.freeze(et);const it={wholeTone:[0,2,2,2,2,2,2],major:[0,2,2,1,2,2,2],major7s4s5:[0,2,2,2,2,1,2],dorian:[0,2,1,2,2,2,1],phrygian:[0,1,2,2,2,1,2],lydian:[0,2,2,2,1,2,2],lydianDominant:[0,2,2,2,1,2,1],mixolydian:[0,2,2,1,2,2,1],mixolydianFlat6:[0,2,2,1,2,1,2],locrian:[0,1,2,2,1,2,2],superLocrian:[0,1,2,1,2,2,2],minor:[0,2,1,2,2,1,2],minor7b9:[0,1,2,2,2,2,1],minor7b5:[0,2,1,2,1,2,2],harmonicMajor:[0,2,2,1,2,1,3],harmonicMinor:[0,2,1,2,2,1,3],doubleHarmonic:[0,1,3,1,2,1,3],melodicMinorAscending:[0,2,1,2,2,2,2],melodicMinorDescending:[0,2,2,1,2,2,1],majorPentatonic:[0,2,2,3,2],majorPentatonicBlues:[0,2,1,1,3,2],minorPentatonic:[0,3,2,2,3],minorPentatonicBlues:[0,3,2,1,1,3],b5Pentatonic:[0,3,2,1,4,2],minor6Pentatonic:[0,3,2,2,2,3],enigmaticMajor:[0,1,3,2,2,2,1],enigmaticMinor:[0,1,2,3,1,3,1],dim8Tone:[0,2,1,2,1,2,1,2],dom8Tone:[0,1,2,1,2,1,2,1],neapolitanMajor:[0,1,2,2,2,2,2],neapolitanMinor:[0,1,2,2,2,1,3],hungarianMajor:[0,3,1,2,1,2,1],hungarianMinor:[0,2,1,3,1,1,3],hungarianGypsy:[0,1,3,1,2,1,3],spanish:[0,1,2,1,2,2,2],spanish8Tone:[0,1,2,1,1,1,2,2],spanishGypsy:[0,1,3,1,2,1,2],augmented:[0,3,1,3,1,3,1],dominantSuspended:[0,2,3,2,2,1,2],bebopMajor:[0,2,2,1,2,1,1,2],bebopDominant:[0,2,2,1,2,2,1,1],mystic:[0,2,2,2,3,2],overtone:[0,2,2,2,1,1,2],leadingTone:[0,2,2,2,2,2,1],hirojoshi:[0,2,1,4,1],japaneseA:[0,1,4,1,3],japaneseB:[0,2,3,1,3],oriental:[0,1,3,1,1,3,1],persian:[0,1,4,1,2,3],arabian:[0,2,2,1,1,2,2],balinese:[0,1,2,4,1],kumoi:[0,2,1,4,2,2],pelog:[0,1,2,3,1,1],algerian:[0,2,1,2,1,1,1,3],chinese:[0,4,2,1,4],mongolian:[0,2,2,3,2],egyptian:[0,2,3,2,3],romainian:[0,2,1,3,1,2,1],hindu:[0,2,2,1,2,1,2],insen:[0,1,4,2,3],iwato:[0,1,4,1,4],scottish:[0,2,3,2,2],yo:[0,3,2,2,3],istrian:[0,1,2,2,2,1,2],ukranianDorian:[0,2,1,3,1,2,1],petrushka:[0,1,3,2,1,3],ahavaraba:[0,1,3,1,2,1,2]};it.halfDiminished=it.minor7b5,it.jewish=it.spanish8Tone,it.byzantine=it.doubleHarmonic,it.acoustic=it.lydianDominant,it.aeolian=it.minor,it.ionian=it.major,Object.keys(it).forEach(t=>Object.freeze(it[t]));const nt=/([A-G])(?![^(]*\))/g,st=/(#|s|b)(?![^(]*\))/g,at=/([0-9]+)(?![^(]*\))/g,ot=/(\([a-zA-Z]{2,}\))/g,rt=(e,i=!1)=>{try{var n=ct(e);if(n)return n;i||console.warn(`Ineffecient scale string formatting - ${e}. Get a performanc increase by using a valid format`)}catch(t){i||console.warn(`Ineffecient scale string formatting - ${e}. Get a performanc increase by using a valid format`)}let s=0,a="",o="";n=e.match(nt)?.join("").split("");const t=e.match(st)?.join("").split("");var r,i=e.match(at)?.join("").split("");const h=e.match(ot)?.join("").split("");if(t&&(s=1<t.length?t.map(t=>j(t)).reduce((t,e)=>t+e):j(t[0])),i&&([r]=i,a=r),h&&(r=h.join(""),o=r),n){var[n]=n,l=n;let t=0;s&&(t=s);n=v(f(l)+t,d,_).value;let e=4;a&&(e=g(parseInt(a,10),b,y));let i=1;if(o&&(i=Object.keys(it).findIndex(t=>t.toLowerCase().includes(o.toLowerCase().replace(/\(|\)/g,"")))),-1===i)throw console.log("UNKNOWN TEMPLATE",o),new Error("Unable to find template for scale "+o);l=it[Object.keys(it)[i]];return{key:n,octave:e,template:l}}throw new Error("Invalid Scale: "+e)},ht=()=>{const e={};var t=["A","B","C","D","E","F","G"],i=["b","#","s"];for(const o of Object.keys(it))for(const r of t){e[`${r}(${o})`]=rt(r,!0);for(const h of i){var n=""+r+h+`(${o})`;e[n]=rt(n,!0)}for(let t=b;t<y;++t){var s=""+r+t+`(${o})`;e[s]=rt(s,!0);for(const l of i){var a=""+r+l+t+`(${o})`;e[a]=rt(a,!0)}}}return e};let lt={};const ct=t=>(lt=lt||ht(),lt[t]);r(()=>{lt=ht()});const mt=(e,i=!1)=>{try{var t=ft(JSON.stringify(e));if(t)return t}catch(t){i||console.warn(t)}const n=Object.keys(it);var s=Object.values(it);const a=[];for(let t=0;t<n.length;++t)Z(s[t],e)&&a.push(n[t].charAt(0).toUpperCase()+n[t].slice(1));return a.join(" AKA ")},pt=()=>{const t={};for(const e of Object.values(it))t[JSON.stringify(e)]=mt(e,!0);return t};let ut={};const ft=t=>(ut[t]||(ut=pt()),ut[t]);r(()=>{ut=pt()});class vt{constructor(t){t?("string"==typeof t&&(t=rt(t)),this.template=[...t?.template??et],this.key=t.key||0,this.octave=t.octave||4):(this.template=et,this.key=0,this.octave=4),this.generateNotes()}id=E();equals(t){return this._key===t._key&&this._octave===t._octave&&Z(this._template,t._template)}copy(){const t=new vt({key:this.key,octave:this.octave,template:R(this.template)});return 0!==this._shiftedInterval&&t.shift(this._shiftedInterval),t}_key=0;get key(){return this._key}set key(t){t=v(t,d,_);this.octave=this.octave+t.numWraps,this._key=t.value,this.generateNotes()}_octave=4;get octave(){return this._octave}set octave(t){this._octave=g(t,b,y),this.generateNotes()}_template=[];get template(){return R(this._template)}set template(t){this._template=R(t),this._shiftedInterval=0,this.generateNotes()}_notes=[];get notes(){return this._notes}generateNotes(){var t,e=H(this._template,-this._shiftedInterval);const i=[];let n=this.key;for(const a of e){var s=0===a?n=this.key:n+=a,s=new G({semitone:s,octave:this.octave});i.push(s)}0<this._shiftedInterval&&(t=i.splice(i.length-(this._shiftedInterval+1),1/0),i.unshift(...t)),this._shiftedInterval<0&&(t=i.splice(0,this._shiftedInterval),i.push(...t)),this._notes=i}getNoteNames(t=!0){return vt.scaleNoteNameLookup(this,t)}degree(t){t=v(t-1,0,this.notes.length-1);const e=this.notes[t.value].copy();return e.octave=this.octave+t.numWraps,console.log(e),e}relativeMajor(){return new vt({template:it.major,key:this.degree(3).semitone,octave:this.octave})}relativeMinor(){return new vt({template:it.minor,key:this.degree(6).semitone,octave:this.octave})}_shiftedInterval=0;_originalTemplate=[];shift(t=1){return 0===this._shiftedInterval&&(this._originalTemplate=R(this._template)),this._template=H(this._template,t),this._shiftedInterval+=t,this.generateNotes(),this}shifted(t=1){const e=this.copy();return e.shift(t),e}unshift(){return 0!==this._shiftedInterval&&(0<this._originalTemplate.length&&(this._template=this._originalTemplate),this._shiftedInterval=0,this._originalTemplate=[],this.generateNotes()),this}unshifted(){const t=this.copy();return this._originalTemplate.length&&(t.template=this._originalTemplate),t.unshift(),t}shiftedInterval(){return this._shiftedInterval}ionian(){const t=this.copy();return t.template=it.ionian,t}dorian(){const t=this.copy();return t.template=it.dorian,t}phrygian(){const t=this.copy();return t.template=it.phrygian,t}lydian(){const t=this.copy();return t.template=it.lydian,t}mixolydian(){const t=this.copy();return t.template=it.mixolydian,t}aeolian(){const t=this.copy();return t.template=it.aeolian,t}locrian(){const t=this.copy();return t.template=it.locrian,t}toString(){let t=mt(this._template);return t=t||this.getNoteNames().join(", "),""+n[this._key]+this._octave+`(${t})`}static scaleNoteNameLookup(t,e=!0){try{var i=`${t.key}-${t.octave}-`+JSON.stringify(t.template);const n=this._notesLookup[i];if(n)return n}catch(t){}let n=[...t.notes];n=H(n,-t.shiftedInterval());const s=n.map(t=>t.toString().split("/"));var a,o,r,h=n.map(t=>t.octave);const l=["B#","Bs","Cb","E#","Es","Fb"],c=[];for([a,o]of s.entries()){for(const u of o)l.includes(u)&&(r=c.indexOf(u),c.splice(r,1));if(0!==c.length)if(1!==o.length){const f=["A","B","C","D","E","F","G","A","B","C","D","E","F","G"];var m,p=c[c.length-1][0],p=f.indexOf(p),p=f[p+1];o[0].includes(p)?(m=o[0].match(/\d/g),c.push(o[0]+(m?"":h[a]))):(m=o[o.length-1].match(/\d/g),c.push(o[o.length-1]+(m?"":h[a])))}else c.push(o[0]);else c.push(e?o[0]:o[o.length-1])}return H(c,t.shiftedInterval())}static createNotesLookupTable(){const i={};for(let e=d;e<d+y;e++)for(let t=b;t<=y;t++)for(const s of Object.values(it)){var n=new vt({key:e,template:s,octave:t});i[`${e}-${t}-`+JSON.stringify(s)]=vt.scaleNoteNameLookup(n)}return i}static _notesLookup={};static async init(){vt._notesLookup=vt.createNotesLookupTable()}}r(vt.init);const gt=[1,3,5];var _t=new vt;const dt=/([A-G])(?=[^(]*\))/g,yt=/(#|s|b)(?=[^(]*\))/g,bt=/([0-9]+)(?=[^(]*\))/g,jt=/(min|maj|dim|aug)(?![^(]*\))/g,kt=/([#|s|b]?[0-9]+)(?![^(]*\))/g,At=t=>{try{var e=Tt(t);if(e)return e}catch{}let i=0,n="",s="maj",a=[];var o=t.match(dt)?.join("").split("");const r=t.match(yt)?.join("").split("");var h=t.match(bt)?.join("").split(""),e=t.match(jt)?.join(""),t=t.match(kt)?.join("").split("");r&&(i=1<r.length?r.map(t=>j(t)).reduce((t,e)=>t+e):j(r[0])),h&&([h]=h,n=h),e&&(s=e),t&&(a=t);const l=[];if(o){var[o]=o,c=o;let t=0;i&&(t=i);c=v(f(c)+t,d,_).value;let e=4;n&&(e=g(parseInt(n,10),b,y)),l.push(...It[s]);for(const u of a){let t=0;"#"===u[0]||"s"===u[0]?(t=1,a.shift()):"b"===u[0]&&(t=-1,a.shift());var m,p=parseInt(u,10);l.includes(p)?(m=l.indexOf(p),l[m]=[p,t]):l.push([p,t])}return{root:c,octave:e,template:l}}throw new Error("Invalid chord name")},wt=()=>{const e={};var t=["A","B","C","D","E","F","G"],i=["b","#","s"],n=["","2","3","4","5","6","7","9","11","13","b2","b3","b4","b5","b6","b7","b9","b11","b13","s2","s3","s4","s5","s6","s7","s9","s11","s13","#2","#3","#4","#5","#6","#7","#9","#11","#13","7s11","7#11","7b9","7#9","7b5","7#5","7b9b5","7#9#5","7b13","7#13","9#5","9b5","9#11","9b11","9#13","9b13","11#5","11b5","11#9","11b9","11#13","11b13"];for(const r of["maj","min","dim","aug","sus"])for(const h of n)for(const l of t){var s=`(${l})`+r+h;e[s]=At(s);for(const c of i){var a=`(${l}${c})`+r+h;e[a]=At(a);for(let t=b;t<=y;t++){var o=`(${l}${c}${t})`+r+h;e[o]=At(o)}}}return e};let Nt={};const Tt=t=>(0===Nt.length&&(Nt=wt()),Nt[t]);r(()=>{Nt=wt()});const It={maj:[1,3,5],maj4:[1,3,4,5],maj6:[1,3,5,6],maj69:[1,3,5,6,9],maj7:[1,3,5,7],maj9:[1,3,5,7,9],maj11:[1,3,5,7,9,11],maj13:[1,3,5,7,9,11,12],maj7s11:[1,3,5,7,[11,1]],majb5:[1,3,[5,-1]],min:[1,[3,-1],5],min4:[1,[3,-1],4,5],min6:[1,[3,-1],5,6],min7:[1,[3,-1],5,[7,-1]],minAdd9:[1,[3,-1],5,9],min69:[1,[3,-1],5,6,9],min9:[1,[3,-1],5,[7,-1],9],min11:[1,[3,-1],5,[7,-1],9,11],min13:[1,[3,-1],5,[7,-1],9,11,13],min7b5:[1,[3,-1],[5,-1],[7,-1]],dom7:[1,3,5,[7,-1]],dom9:[1,3,5,[7,-1],9],dom11:[1,3,5,[7,-1],9,11],dom13:[1,3,5,[7,-1],9,11,13],dom7s5:[1,3,[5,1],[7,-1]],dom7b5:[1,3,[5,-1],[7,-1]],dom7b9:[1,3,5,[7,-1],[9,-1]],dom7s9:[1,3,5,[7,-1],[9,1]],dom9s5:[1,3,[5,1],[7,-1],9],dom9b5:[1,3,[5,-1],[7,-1],9],dom7s5s9:[1,3,[5,1],[7,-1],[9,1]],dom7s5b9:[1,3,[5,1],[7,-1],[9,-1]],dom7s11:[1,3,5,[7,-1],[11,1]],dim:[1,[3,-1],[5,-1]],dim7:[1,[3,-1],[5,-1],[7,-2]],aug:[1,3,[5,1]],sus2:[1,2,5],sus4:[1,[4,-1],5],fifth:[1,5],b5:[1,[5,-1]],s11:[1,5,[11,1]]};Object.keys(It).forEach(t=>Object.freeze(It[t])),t.Chord=class Dt{constructor(t){var e;t?"string"==typeof t?(e=At(t),this._template=[...e?.template??gt],this.octave=e?.octave??4,this.root=e?.root??0):(this._template=t.template??gt,this.octave=t.octave??4,this.root=t.root??0):(this._template=gt,this.octave=4,this.root=0),this._baseScale=new vt({key:this._root,octave:this._octave}),this._notesDirty=!0}id=E();_root=0;get root(){return this._root}set root(t){t=v(t,d,_),this._root=t.value,this._octave=this._octave+t.numWraps,this._notesDirty=!0}_baseScale=_t;get baseScale(){return this._baseScale}set baseScale(t){this._baseScale=t,this._baseScale.octave=this._octave,this._notesDirty=!0}_octave=4;get octave(){return this._octave}set octave(t){this._octave=g(t,b,y),this._baseScale.octave=this._octave,this._notesDirty=!0}_template=[];get template(){return[...this._template]}set template(t){this._template=[...t],this._notesDirty=!0}_notes=[];_notesDirty=!0;get notes(){return this._notesDirty&&(this.generateNotes(),this._notesDirty=!1),this._notes}generateNotes(){this._notes=[];for(const n of this._template){let t=0,e=0;Array.isArray(n)?(t=n[0],e=n[1]):t=n;var i=t;const s=this._baseScale.degree(i);i=s.semitone,s.semitone=i+e,this._notes.push(s)}return this._notes}getNoteNames(){const t=[];for(const e of this.notes)t.push(e.toString());return t}copy(){return new Dt({root:this.root,octave:this.octave,template:[...this._template]})}equals(t){return this.root===t.root&&this.octave===t.octave&&Z(this._template,t.template)}augment(){let e=-1;for(let t=0;t<this._template.length;++t){if(5===this._template[t]){e=t;break}var i=this._template[t];if(Array.isArray(i)&&5===(i[0]??0)){e=t;break}}return-1===e?this._template.push([5,1]):this._template[e]=[5,1],this._notesDirty=!0,this}augmented(){return this.copy().augment()}isAugmented(){for(const t of this._template)if(Array.isArray(t)&&5===(t[0]??0)&&1===(t[1]??0))return!0;return!1}diminish(){let e=-1;for(let t=0;t<this._template.length;++t){if(5===this._template[t]){e=t;break}var i=this._template[t];if(Array.isArray(i)&&5===(i[0]??0)){e=t;break}}return-1===e?this._template.push([5,-1]):this._template[e]=[5,-1],this._notesDirty=!0,this}diminished(){return this.copy().diminish()}isDiminished(){for(const t of this._template)if(Array.isArray(t)&&5===(t[0]??0)&&-1===(t[1]??0))return!0;return!1}halfDiminish(){let e=-1;for(let t=0;t<this._template.length;++t){if(7===this._template[t]){e=t;break}var i=this._template[t];if(Array.isArray(i)&&7===(i[0]??0)){e=t;break}}return-1===e?this._template.push([7,-1]):this._template[e]=[7,-1],this._notesDirty=!0,this}halfDiminished(){return this.copy().halfDiminish()}isHalfDiminished(){for(const t of this._template)if(Array.isArray(t)&&7===(t[0]??0)&&-1===(t[1]??0))return!0;return!1}invert(){console.log(this._template[0]),Array.isArray(this._template[0])?this._template[0][0]+=this._baseScale.template.length:this._template[0]+=this._baseScale.template.length,console.log(this._template[0]);var t=H(this._template,this._template.length-1);return this._template=t,this._notesDirty=!0,this}},t.ChordTemplates=It,t.Instrument=class St{tuning;constructor(t=440){this.tuning=new C(t)}id=E();copy(){return new St(this.tuning.a4)}equals(t){return this.tuning.equals(t.tuning)}getFrequency(t){return this.tuning.freqLookup(t.octave,t.semitone)}getMidiKey(t){return this.tuning.midiKeyLookup(t.octave,t.semitone)}toString(){return`Instrument Tuning(${this.tuning.a4})`}},t.Modifier=a,t.Note=G,t.Scale=tt,t.ScaleTemplates=F,t.Semitone=n,t.init=t=>{for(const e of o)e();t&&t()},t.initAsync=async t=>{for(const e of o)e();t&&t()},Object.defineProperty(t,"__esModule",{value:!0})});
